<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pelik√°n Kezel≈ëpult | Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</head>

<body>
    <!-- Oldals√°v -->
    <div class="mobile-menu-btn"><ion-icon name="menu-outline"></ion-icon></div>
    <nav id="sidebar">
        <div class="logo">
            <div class="logo-image">
                <img src="pelikan2.png" alt="Logo">
                <span class="logo-text">Pelik√°n Dashboard</span>
            </div>
            <div class="close-sidebar"><ion-icon name="close-outline"></ion-icon></div>
        </div>
        <div class="menu-items">
            <ul class="navLinks">
                <li class="navList active" data-target="dashboard">
                    <a href="#">
                        <ion-icon name="home-outline"></ion-icon>
                        <span class="links">Dashboard</span>
                    </a>
                </li>
                <li class="navList" data-target="create-post">
                    <a href="#">
                        <ion-icon name="create-outline"></ion-icon>
                        <span class="links">Poszt l√©trehoz√°sa</span>
                    </a>
                </li>
                <!-- A "Hozz√°sz√≥l√°sok" alatt helyezz√ºk el -->
<li id="reviews-nav-placeholder"></li>
                <li class="navList" data-target="articles">
                    <a href="#">
                        <ion-icon name="folder-outline"></ion-icon>
                        <span class="links">Cikkeim</span>
                        <span class="notification-badge">3</span>
                    </a>
                </li>
                <li class="navList" data-target="analytics">
                    <a href="#">
                        <ion-icon name="analytics-outline"></ion-icon>
                        <span class="links">Analytics</span>
                    </a>
                </li>
                <li class="navList" data-target="comments">
                    <a href="#">
                        <ion-icon name="chatbubble-outline"></ion-icon>
                        <span class="links">Hozz√°sz√≥l√°sok</span>
                        <span class="notification-badge">12</span>
                    </a>
                </li>
            </ul>
            <ul class="bottom-link">
                <li>
                    <a href="profile.html">
                        <ion-icon name="person-circle-outline"></ion-icon>
                        <span class="links">Profil</span>
                    </a>
                </li>
                                <li>
                    <a href="settings.html">
                        <ion-icon name="person-circle-outline"></ion-icon>
                        <span class="links">Be√°ll√≠t√°sok</span>
                    </a>
                </li>
                <li>
                    <a href="../logout.php">
                        <ion-icon name="log-out-outline"></ion-icon>
                        <span class="links">Kijelentkez√©s</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Tartalom -->
    <section class="dashboard">
        <div class="container">
            <!-- Fejl√©c -->
            <div class="dashboard-header">
                <div class="header-left">
                    <h1>√údv√∂zl√ºnk, <span class="user-name" id="user-display-name">Vend√©g</span>!</h1>
                    <p class="page-description">√çme a mai √∂sszefoglal√≥ (m√©g nincs behozva)</p>
                </div>
                <!-- Fejl√©c jobb oldali r√©sz -->
<div class="header-right">
    <div class="search-box">
        <ion-icon name="search-outline"></ion-icon>
        <input type="text" placeholder="Keres√©s...">
    </div>
    
    <!-- Profil ter√ºlet -->
    <div class="user-profile">
        <div class="profile-img" id="profile-toggle-btn">
            <img id="user-profile-image" src="https://ui-avatars.com/api/?name=Guest&background=666&color=fff" alt="Profil">
        </div>
        
        <!-- Dropdown men√º -->
        <div class="profile-dropdown" id="profile-dropdown">
            <div class="dropdown-content" id="dropdown-content">
                <!-- Tartalom JavaScript alapj√°n t√∂lt≈ëdik -->
            </div>
        </div>
    </div>
</div>
            </div>

            <!-- Dashboard -->
            <div class="overview" id="dashboard">
                <div class="title"><ion-icon name="speedometer"></ion-icon><span class="text">Dashboard</span></div>
                <div class="boxes">
                    <div class="box box1">
                        <div class="box-icon">
                            <ion-icon name="eye-outline"></ion-icon>
                        </div>
                        <div class="box-content">
                            <span class="number">2,847</span>
                            <span class="text">√ñsszes Megtekint√©s</span>
                            <span class="trend positive">+12%</span>
                        </div>
                    </div>
                    <div class="box box2">
                        <div class="box-icon">
                            <ion-icon name="people-outline"></ion-icon>
                        </div>
                        <div class="box-content">
                            <span class="number">1,234</span>
                            <span class="text">Akt√≠v felhaszn√°l√≥</span>
                            <span class="trend positive">+5%</span>
                        </div>
                    </div>
                    <div class="box box3">
                        <div class="box-icon">
                            <ion-icon name="chatbubbles-outline"></ion-icon>
                        </div>
                        <div class="box-content">
                            <span class="number">568</span>
                            <span class="text">√ñsszes tev√©kenys√©g</span>
                            <span class="trend negative">-2%</span>
                        </div>
                    </div>
                    <div class="box box4">
                        <div class="box-icon">
                            <ion-icon name="document-text-outline"></ion-icon>
                        </div>
                        <div class="box-content">
                            <span class="number">42</span>
                            <span class="text">√ñsszes cikk</span>
                            <span class="trend positive">+8%</span>
                        </div>
                    </div>
                </div>

                <!-- Grafikon √©s legfrissebb cikkek -->
                <div class="dashboard-content">
                    <div class="chart-container">
                        <div class="data-table">
                            <div class="table-header">
                                <h3>Megtekint√©sek (elm√∫lt 7 nap)</h3>
                                <div class="chart-actions">
                                    <button class="btn-chart active">7 nap</button>
                                    <button class="btn-chart">30 nap</button>
                                    <button class="btn-chart">1 √©v</button>
                                </div>
                            </div>
                            <div class="chart-placeholder">
                                <div class="chart-visual">
                                    <div class="chart-bar" style="height: 30%"></div>
                                    <div class="chart-bar" style="height: 60%"></div>
                                    <div class="chart-bar" style="height: 45%"></div>
                                    <div class="chart-bar" style="height: 80%"></div>
                                    <div class="chart-bar" style="height: 65%"></div>
                                    <div class="chart-bar" style="height: 50%"></div>
                                    <div class="chart-bar" style="height: 75%"></div>
                                </div>
                                <div class="chart-labels">
                                    <span>H</span>
                                    <span>K</span>
                                    <span>Sze</span>
                                    <span>Cs</span>
                                    <span>P</span>
                                    <span>Szo</span>
                                    <span>V</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recent-articles">
                        <div class="data-table">
                            <div class="table-header">
                                <h3>Legfrissebb cikkek</h3>
                                <a href="#" class="view-all">√ñsszes megtekint√©se</a>
                            </div>
                            <div class="articles-list">
                                <div class="article-item">
                                    <div class="article-info">
                                        <h4>A digit√°lis √°t√°ll√°s kih√≠v√°sai 2023-ban</h4>
                                        <span class="article-date">2023. okt√≥ber 12.</span>
                                    </div>
                                    <div class="article-stats">
                                        <span class="stat"><ion-icon name="eye-outline"></ion-icon> 1,245</span>
                                        <span class="stat"><ion-icon name="chatbubble-outline"></ion-icon> 32</span>
                                    </div>
                                </div>
                                <div class="article-item">
                                    <div class="article-info">
                                        <h4>Mesters√©ges intelligencia a mindennapokban</h4>
                                        <span class="article-date">2023. okt√≥ber 5.</span>
                                    </div>
                                    <div class="article-stats">
                                        <span class="stat"><ion-icon name="eye-outline"></ion-icon> 892</span>
                                        <span class="stat"><ion-icon name="chatbubble-outline"></ion-icon> 18</span>
                                    </div>
                                </div>
                                <div class="article-item">
                                    <div class="article-info">
                                        <h4>Fenntarthat√≥ v√°rosfejleszt√©si modellek</h4>
                                        <span class="article-date">2023. szeptember 28.</span>
                                    </div>
                                    <div class="article-stats">
                                        <span class="stat"><ion-icon name="eye-outline"></ion-icon> 1,567</span>
                                        <span class="stat"><ion-icon name="chatbubble-outline"></ion-icon> 45</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Poszt l√©trehoz√°sa -->
            <div class="data-table" id="create-post" style="display:none">
                <div class="table-header">
                    <div class="title"><ion-icon name="create-outline"></ion-icon><span class="text">√öj poszt l√©trehoz√°sa</span></div>
                </div>
                <div class="create-post-form">
                    <form id="post-form">
                        <div class="form-group">
                            <label for="post-title">C√≠m</label>
                            <input type="text" id="post-title" placeholder="Add meg a poszt c√≠m√©t..." required>
                        </div>
                        
                        <div class="form-group">
                            <label for="post-excerpt">R√∂vid le√≠r√°s</label>
                            <textarea id="post-excerpt" placeholder="R√∂vid le√≠r√°s a posztr√≥l..." rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="post-content">Tartalom</label>
                            <div class="editor-toolbar">
                                <button type="button" class="toolbar-btn" data-command="bold"><strong>B</strong></button>
                                <button type="button" class="toolbar-btn" data-command="italic"><em>I</em></button>
                                <button type="button" class="toolbar-btn" data-command="insertUnorderedList">‚Ä¢ Lista</button>
                                <button type="button" class="toolbar-btn" data-command="createLink">üîó Link</button>
                            </div>
                            <textarea id="post-content" placeholder="√çdd ide a poszt tartalm√°t..." rows="15"></textarea>
                        </div>
                        
                        <!-- A form-row div ut√°n, az "authors" div-et besz√∫rni -->
<div class="form-row">
<!-- A kateg√≥ria mez≈ët √≠gy m√≥dos√≠tsd: -->
<div class="form-group">
    <label>Kateg√≥ri√°k</label>
    <!-- Ide fognak bet√∂lt≈ëdni a kiv√°lasztott kateg√≥ria chip-ek -->
    <div id="selected-categories-container" style="
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #ddd;
        min-height: 50px;
    ">
        <div style="color: #666; font-style: italic;">
            Nincs kiv√°lasztott kateg√≥ria
        </div>
    </div>
    
    <!-- Kateg√≥ria v√°laszt√≥ gomb -->
    <button type="button" class="btn-select-authors" id="select-category-btn" style="margin-top: 10px;">
        <ion-icon name="folder-outline"></ion-icon>
        <span>Kateg√≥ri√°k kiv√°laszt√°sa</span>
    </button>
    
    <!-- Rejtett input a kiv√°lasztott kateg√≥ri√°k t√°rol√°s√°ra -->
    <input type="hidden" id="post-categories" name="categories">
</div>

    <div class="form-group">
        <label for="post-tags">C√≠mk√©k</label>
        <input type="text" id="post-tags" placeholder="Vessz≈ëvel elv√°lasztva...">
    </div>
</div>

<!-- IDEGEN SZERZ≈êK - M√ìDOS√çTOTT R√âSZ -->
<div class="form-row">
    <div class="form-group">
        <label for="post-authors">Tov√°bbi szerz≈ëk</label>
        
        <!-- Kiv√°lasztott szerz≈ëk megjelen√≠t√©se -->
        <div class="selected-authors-container" id="selected-authors-container">
            <!-- Ide j√∂nnek a kiv√°lasztott szerz≈ëk c√≠mk√©i -->
            <div class="no-authors-message" id="no-authors-message">
                <ion-icon name="people-outline"></ion-icon>
                <span>Nincsenek kiv√°lasztott szerz≈ëk</span>
            </div>
        </div>
        
        <!-- Rejtett mez≈ë a szerz≈ë UID-ek t√°rol√°s√°ra -->
        <input type="hidden" id="post-authors" name="authors">
        
        <!-- Szerz≈ëv√°laszt√≥ gomb -->
        <button type="button" class="btn-select-authors" id="select-authors-btn">
            <ion-icon name="person-add-outline"></ion-icon>
            <span>Szerz≈ëk kiv√°laszt√°sa</span>
        </button>
        
        <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">
            Kattints a gombra a szerz≈ëk list√°j√°b√≥l val√≥ kiv√°laszt√°shoz
        </small>
    </div>
    
    <div class="form-group">
        <label for="post-status">St√°tusz</label>
        <select id="post-status">
            <option value="draft">V√°zlat</option>
            <option value="published">Publik√°lva</option>
        </select>
    </div>
</div>
<!-- IDEGEN SZERZ≈êK V√âGE -->

<div class="form-row">
    <div class="form-group">
        <label for="post-featured">Kiemelt k√©p</label>
        <div class="file-upload">
            <input type="file" id="post-featured" accept="image/*">
            <label for="post-featured" class="upload-btn">
                <ion-icon name="cloud-upload-outline"></ion-icon>
                <span>K√©p felt√∂lt√©se</span>
            </label>
        </div>
    </div>
</div>
                            
                            <div class="form-group">
                                <label for="post-featured">Kiemelt k√©p</label>
                                <div class="file-upload">
                                    <input type="file" id="post-featured" accept="image/*">
                                    <label for="post-featured" class="upload-btn">
                                        <ion-icon name="cloud-upload-outline"></ion-icon>
                                        <span>K√©p felt√∂lt√©se</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-secondary">Ment√©s v√°zlatk√©nt</button>
                            <button type="submit" class="btn-primary">Poszt elk√ºld√©se a lektornak</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Cikkek -->
<!-- dashboard.html - Cikkeim szekci√≥ r√©sz -->
<div class="data-table" id="articles" style="display:none">
    <div class="table-header">
        <div class="title"><ion-icon name="folder-outline"></ion-icon><span class="text">Cikkeim</span></div>
        <button class="btn-primary" id="new-article-btn"><ion-icon name="add-outline"></ion-icon> √öj cikk</button>
    </div>
    
    <div class="articles-filter">
        <button class="filter-btn active" data-filter="all">√ñsszes</button>
        <button class="filter-btn" data-filter="published">Publik√°lt</button>
        <button class="filter-btn" data-filter="draft">V√°zlat</button>
        <button class="filter-btn" data-filter="pending">Ellen≈ërz√©s alatt</button>
    </div>
    
    <div class="articles-container" id="articles-container">
        <!-- Ide t√∂lt≈ëdnek be a cikkek JavaScript alapj√°n -->
        <div class="loading-state" id="articles-loading">
            <ion-icon name="sync-outline" class="loading-icon"></ion-icon>
            <p>Cikkek bet√∂lt√©se...</p>
        </div>
    </div>
</div>

            <!-- Analytics -->
            <div class="data-table" id="analytics" style="display:none">
                <div class="table-header">
                    <div class="title"><ion-icon name="analytics-outline"></ion-icon><span class="text">Analytics</span></div>
                    <div class="analytics-period">
                        <select>
                            <option>Elm√∫lt 7 nap</option>
                            <option>Elm√∫lt 30 nap</option>
                            <option>Elm√∫lt 3 h√≥nap</option>
                            <option>Elm√∫lt √©v</option>
                        </select>
                    </div>
                </div>
                <div class="analytics-content">
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h4>Audience Overview</h4>
                            <div class="analytics-placeholder">
                                <div class="chart-placeholder large">
                                    <div class="chart-visual">
                                        <div class="chart-bar" style="height: 40%"></div>
                                        <div class="chart-bar" style="height: 70%"></div>
                                        <div class="chart-bar" style="height: 55%"></div>
                                        <div class="chart-bar" style="height: 85%"></div>
                                        <div class="chart-bar" style="height: 60%"></div>
                                        <div class="chart-bar" style="height: 45%"></div>
                                        <div class="chart-bar" style="height: 75%"></div>
                                    </div>
                                    <div class="chart-labels">
                                        <span>H</span>
                                        <span>K</span>
                                        <span>Sze</span>
                                        <span>Cs</span>
                                        <span>P</span>
                                        <span>Szo</span>
                                        <span>V</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="analytics-card">
                            <h4>Top Tartalmak</h4>
                            <div class="top-content-list">
                                <div class="top-item">
                                    <div class="item-rank">1</div>
                                    <div class="item-info">
                                        <div class="item-title">A digit√°lis √°t√°ll√°s kih√≠v√°sai</div>
                                        <div class="item-stats">1,245 megtekint√©s</div>
                                    </div>
                                </div>
                                <div class="top-item">
                                    <div class="item-rank">2</div>
                                    <div class="item-info">
                                        <div class="item-title">Fenntarthat√≥ v√°rosfejleszt√©s</div>
                                        <div class="item-stats">1,056 megtekint√©s</div>
                                    </div>
                                </div>
                                <div class="top-item">
                                    <div class="item-rank">3</div>
                                    <div class="item-info">
                                        <div class="item-title">Mesters√©ges intelligencia</div>
                                        <div class="item-stats">892 megtekint√©s</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-stats">
                        <div class="stat-card">
                            <div class="stat-value">64%</div>
                            <div class="stat-label">Visszat√©r≈ë l√°togat√≥k</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">2:45</div>
                            <div class="stat-label">√Åtlagos id≈ë oldalon</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">42%</div>
                            <div class="stat-label">Kattint√°si r√°ta</div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Lektor√°l√°s -->
<div class="data-table" id="reviews" style="display:none">
    <div class="table-header">
        <div class="title">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            <span class="text">Lektor√°l√°s</span>
        </div>
        <div class="review-actions">
            <button class="btn-secondary" id="refresh-reviews-btn">
                <ion-icon name="refresh-outline"></ion-icon>
                Friss√≠t√©s
            </button>
        </div>
    </div>
    
    
    <!-- Sz≈±r≈ëk -->
   <div class="reviews-filter">
        <button class="filter-btn active" data-filter="pending">F√ºgg≈ëben l√©v≈ëk</button>
        <button class="filter-btn" data-filter="edited">Szerkeszt√©sek</button>
        <button class="filter-btn" data-filter="all">√ñsszes</button>
    </div>
    
    <!-- Tartalom kont√©ner -->
    <div class="reviews-container" id="reviews-container">
        <div class="loading-state" id="reviews-loading">
            <ion-icon name="sync-outline" class="loading-icon"></ion-icon>
            <p>Lektor√°l√°si lista bet√∂lt√©se...</p>
        </div>
    </div>
</div>


            <!-- Hozz√°sz√≥l√°sok -->
            <div class="data-table" id="comments" style="display:none">
                <div class="table-header">
                    <div class="title"><ion-icon name="chatbubble-outline"></ion-icon><span class="text">Hozz√°sz√≥l√°sok</span></div>
                    <div class="comments-filter">
                        <button class="btn-filter active">√ñsszes</button>
                        <button class="btn-filter">F√ºgg≈ëben</button>
                        <button class="btn-filter">J√≥v√°hagyott</button>
                        <button class="btn-filter">Elutas√≠tott</button>
                    </div>
                </div>
                <div class="comments-list">
                    <div class="comment-item pending">
                        <div class="comment-avatar">
                            <img src="https://ui-avatars.com/api/?name=Kata+Kiss&background=1891d1&color=fff" alt="Avatar">
                        </div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <div class="comment-author">Kata Kiss</div>
                                <div class="comment-date">2023. okt√≥ber 15. 14:23</div>
                            </div>
                            <p class="comment-text">Nagyon informat√≠v cikk, k√∂sz√∂n√∂m a r√©szletes elemz√©st! Egyet√©rtek azzal, hogy a digit√°lis √°t√°ll√°s egyik legnagyobb kih√≠v√°sa a szem√©lyes kapcsolatok fenntart√°sa.</p>
                            <div class="comment-article">
                                <ion-icon name="document-text-outline"></ion-icon>
                                <a href="#">A digit√°lis √°t√°ll√°s kih√≠v√°sai 2023-ban</a>
                            </div>
                            <div class="comment-actions">
                                <button class="btn-success">J√≥v√°hagy√°s</button>
                                <button class="btn-danger">Elutas√≠t√°s</button>
                                <button class="btn-secondary">V√°lasz</button>
                            </div>
                        </div>
                    </div>
                    <div class="comment-item approved">
                        <div class="comment-avatar">
                            <img src="https://ui-avatars.com/api/?name=Peter+Nagy&background=20c997&color=fff" alt="Avatar">
                        </div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <div class="comment-author">P√©ter Nagy</div>
                                <div class="comment-date">2023. okt√≥ber 14. 09:12</div>
                            </div>
                            <p class="comment-text">A cikkben eml√≠tett fenntarthat√≥s√°gi modellek nagyon hasznosak lehetnek a v√°rosunk fejleszt√©s√©hez. Megosztom a helyi √∂nkorm√°nyzattal!</p>
                            <div class="comment-article">
                                <ion-icon name="document-text-outline"></ion-icon>
                                <a href="#">Fenntarthat√≥ v√°rosfejleszt√©si modellek</a>
                            </div>
                            <div class="comment-actions">
                                <button class="btn-danger">Elutas√≠t√°s</button>
                                <button class="btn-secondary">V√°lasz</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div> <!-- container z√°r√°sa -->
    </section> <!-- dashboard z√°r√°sa -->

    <script src="dashboard.js"></script>
    <script src="profildropdown.js"></script>
    <script src="category-selector.js"></script>





<script>

document.addEventListener('DOMContentLoaded', function() {
    console.log('Dashboard bet√∂ltve - profil kezel√©s inicializ√°l√°sa');
    
    const profileToggleBtn = document.getElementById('profile-toggle-btn');
    const profileDropdown = document.getElementById('profile-dropdown');
    
    if (profileToggleBtn) {
        profileToggleBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            console.log('Profil ikonra kattintottak');
            profileDropdown.classList.toggle('active');
        });
    }
    
    document.addEventListener('click', function(e) {
        if (profileToggleBtn && !profileToggleBtn.contains(e.target) && 
            profileDropdown && !profileDropdown.contains(e.target)) {
            profileDropdown.classList.remove('active');
        }
    });
    
    loadUserProfile();
});

// Remeljuk betolti a profilt
async function loadUserProfile() {
    console.log('===== FELHASZN√ÅL√ìI PROFIL BET√ñLT√âSE =====');
    
    // Token lek√©r√©se
    const token = getAuthToken();
    console.log('Token √°llapot:', token ? 'Megvan' : 'Nincs');
    
    if (!token) {
        console.log('Nincs token - felhaszn√°l√≥ nincs bejelentkezve vagy token hi√°nyzik');
        showGuestProfile();
        return;
    }
    
    console.log('Token els≈ë 10 karaktere:', token.substring(0, 10) + '...');
    
    try {
        console.log('API h√≠v√°s ind√≠t√°sa...');
        const userData = await fetchUserProfile(token);
        
        if (userData && Object.keys(userData).length > 0) {
            console.log('Sikeresen meg√©rkeztek a felhaszn√°l√≥i adatok:', userData);
            updateProfileDisplay(userData);
            updateDropdownContent(userData);
        } else {
            console.log('API v√°lasz √ºres vagy hib√°s');
            showGuestProfile();
        }
    } catch (error) {
        console.error('Hiba t√∂rt√©nt a profil bet√∂lt√©se sor√°n:', error);
        showGuestProfile();
    }
}


async function fetchUserProfile(token) {
    console.log('fetchUserProfile h√≠v√°sa token:', token.substring(0, 10) + '...');
    
    try {
        const response = await fetch('/api/user/get', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                get: 'email, first_name, full_name, alias, roles, pfp'
            })
        });
        
        console.log('API v√°lasz st√°tusz:', response.status);
        
        if (!response.ok) {
            console.error('API hiba:', response.status, response.statusText);
          
            if (response.status === 401 || response.status === 403) {
                clearAuth();
                return null;
            }
            return null;
        }
        
        const data = await response.json();
        console.log('API v√°lasz:', data);
        
        return data;
        
    } catch (error) {
        console.error('H√°l√≥zati hiba:', error);
        return null;
    }
}
function showGuestProfile() {
    console.log('Vend√©g profil megjelen√≠t√©se');
    
    const userProfileImage = document.getElementById('user-profile-image');
    const userDisplayName = document.getElementById('user-display-name');
    
    if (userDisplayName) {
        userDisplayName.textContent = 'k√©r√ºnk, jelentkezz be a kezd√©shez';
    }
    
    if (userProfileImage) {
        userProfileImage.src = 'https://ui-avatars.com/api/?name=Vend√©g&background=1891d1&color=fff';
        userProfileImage.alt = 'Vend√©g';
    }
    
    updateDropdownContent(null);
}

// Profil megjelen√≠t√©s friss√≠t√©se
// Profil k√©p bet√∂lt√©s jav√≠t√°sa
function updateProfileDisplay(userData) {
    console.log('Profil megjelen√≠t√©s friss√≠t√©se:', userData);
    
    const userProfileImage = document.getElementById('user-profile-image');
    const userDisplayName = document.getElementById('user-display-name');
    
    if (!userData || Object.keys(userData).length === 0) {
        console.log('Nincs felhaszn√°l√≥i adat - vend√©g m√≥d');
        showGuestProfile();
        return;
    }
    
    let displayName = 'Felhaszn√°l√≥';
    
    if (userData.alias && userData.alias.trim() !== '') {
        displayName = userData.alias;
    } else if (userData.full_name && userData.full_name.trim() !== '') {
        displayName = userData.full_name;
    } else if (userData.first_name && userData.first_name.trim() !== '') {
        displayName = userData.first_name;
    } else if (userData.email) {
        displayName = userData.email.split('@')[0];
    }
    
    if (userDisplayName) {
        userDisplayName.textContent = displayName;
    }
    
    if (userProfileImage) {
        if (userData.pfp && 
            userData.pfp.trim() !== '' && 
            userData.pfp !== 'null' && 
            userData.pfp !== 'undefined' &&
            (userData.pfp.startsWith('http://') || userData.pfp.startsWith('https://'))) {
            
            const img = new Image();
            img.onload = function() {
                userProfileImage.src = userData.pfp;
                userProfileImage.alt = displayName;
                console.log('Profilk√©p bet√∂ltve:', userData.pfp);
            };
            img.onerror = function() {
                createAvatar(displayName, userProfileImage);
            };
            img.src = userData.pfp;
        } else {
            createAvatar(displayName, userProfileImage);
        }
    }
}

function createAvatar(name, imgElement) {
    const nameForAvatar = name.replace(/\s+/g, '+').substring(0, 20);
    const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(nameForAvatar)}&background=1891d1&color=fff&bold=true&size=128`;
    imgElement.src = avatarUrl;
    imgElement.alt = name;
    console.log('Avatar gener√°lva:', avatarUrl);
}

function updateDropdownContent(userData) {
    console.log('Dropdown tartalom friss√≠t√©se');
    
    const dropdownContent = document.getElementById('dropdown-content');
    if (!dropdownContent) {
        console.error('Dropdown content elem nem tal√°lhat√≥!');
        return;
    }
    
    if (userData && Object.keys(userData).length > 0) {
        console.log('Bejelentkezett felhaszn√°l√≥ dropdown tartalom');
        
        let rolesText = 'Nincs';
        if (userData.roles) {
            try {
                if (typeof userData.roles === 'string') {
                    const roles = JSON.parse(userData.roles);
                    rolesText = Array.isArray(roles) ? roles.join(', ') : roles;
                } else if (Array.isArray(userData.roles)) {
                    rolesText = userData.roles.join(', ');
                }
            } catch (e) {
                console.error('Hiba a rangok feldolgoz√°s√°ban:', e);
            }
        }
        
        const displayName = userData.alias || userData.full_name || userData.first_name || 'Felhaszn√°l√≥';
        const email = userData.email || '';
        
        dropdownContent.innerHTML = `
            <div class="dropdown-header">
                <div class="dropdown-user-info">
                    <div class="dropdown-user-name">${displayName}</div>
                    <div class="dropdown-user-email">${email}</div>
                    <div class="dropdown-user-roles" style="font-size: 10px; margin-top: 4px; color: #666;">Rangok: ${rolesText}</div>
                </div>
            </div>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item" id="view-profile-btn">
                <ion-icon name="person-outline"></ion-icon>
                <span>Profil megtekint√©se</span>
            </a>
            <a href="settings.html" class="dropdown-item" id="edit-profile-btn">
                <ion-icon name="create-outline"></ion-icon>
                <span>Profil szerkeszt√©se</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item logout" id="logout-btn">
                <ion-icon name="log-out-outline"></ion-icon>
                <span>Kijelentkez√©s</span>
            </a>
        `;
        
        // 
        setTimeout(() => {
            document.getElementById('view-profile-btn')?.addEventListener('click', function(e) {
                e.preventDefault();
                showProfileDetails(userData);
            });
            
            document.getElementById('edit-profile-btn')?.addEventListener('click', function(e) {
                e.preventDefault();
                editProfile(userData);
            });
            
            document.getElementById('logout-btn')?.addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
        }, 10);
        
    } else {
        console.log('Nem bejelentkezett felhaszn√°l√≥ dropdownja');
        
        dropdownContent.innerHTML = `
            <div class="dropdown-header">
                <div class="dropdown-user-info">
                    <div class="dropdown-user-name">Nincs bejelentkezve.</div>
                    <div class="dropdown-user-email">Jelentkezz be a funkci√≥k haszn√°lat√°hoz</div>
                </div>
            </div>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item" id="login-btn">
                <ion-icon name="log-in-outline"></ion-icon>
                <span>Bejelentkez√©s Google fi√≥kkal</span>
            </a>
        `;
        
        setTimeout(() => {
            document.getElementById('login-btn')?.addEventListener('click', function(e) {
                e.preventDefault();
                const currentPath = window.location.pathname + window.location.search;
                window.location.href = `/api/login/google?redirect=${encodeURIComponent(currentPath)}`;
            });
        }, 10);
    }
}

function getAuthToken() {
    console.log('=== TOKEN KERES√âS ELINDUL ===');
    
    const tokenSources = {
        'localStorage': localStorage.getItem('secret'),
        'sessionStorage': sessionStorage.getItem('secret'),
        'URL param√©ter': new URLSearchParams(window.location.search).get('token')
    };
    
    console.log('Token innen::', tokenSources);
    
    let token = tokenSources['URL param√©ter'];
    
    if (!token && tokenSources['localStorage']) {
        token = tokenSources['localStorage'];
    }
    
    if (!token && tokenSources['sessionStorage']) {
        token = tokenSources['sessionStorage'];
    }
    
    if (tokenSources['URL param√©ter'] && !tokenSources['localStorage']) {
        localStorage.setItem('secret', tokenSources['URL param√©ter']);
        console.log('Token mentve localStorage-ba');
        
        const newUrl = window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
    }
    
    if (token) {
        console.log('Token megtal√°lva:', token.substring(0, 10) + '...');
        return token;
    }
    
    console.log('Token NEM tal√°lhat√≥ sehol!');
    return null;
}

function checkUrlForToken() {
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    
    if (token) {
        console.log('Token tal√°lhat√≥ URL-ben');
        
        localStorage.setItem('secret', token);
        
        const newUrl = window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
        
        loadUserProfile();
        
        return true;
    }
    
    return false;
}

document.addEventListener('DOMContentLoaded', function() {
    console.log('Dashboard oldal bet√∂ltve');
    
    if (!checkUrlForToken()) {
        loadUserProfile();
    }
});

function getCookie(name) {
    const cookies = document.cookie.split(';');
    console.log('√ñsszes cookie:', cookies);
    
    for (let cookie of cookies) {
        const [cookieName, cookieValue] = cookie.trim().split('=');
        if (cookieName === name) {
            console.log(`Cookie "${name}" megtal√°lva:`, cookieValue ? 'van √©rt√©k' : '√ºres');
            return cookieValue || '';
        }
    }
    
    console.log(`Cookie "${name}" nem tal√°lhat√≥`);
    return null;
}

function clearAuth() {
    console.log('Auth adatok t√∂rl√©se...');
    
    // localStorage
    localStorage.removeItem('secret');
    console.log('localStorage t√∂r√∂lve');
    
    // sessionStorage
    sessionStorage.removeItem('secret');
    console.log('sessionStorage t√∂r√∂lve');
    
    // Cookies
    document.cookie = 'secret=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
    document.cookie = 'secret=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=' + window.location.hostname;
    console.log('Cookies t√∂r√∂lve');
}

// Kijelentkez√©s
function logout() {
    console.log('Kijelentkez√©s...');
    clearAuth();
    window.location.href = '/logout.php';
}

function showProfileDetails(userData) {
    console.log('Profil r√©szletek megjelen√≠t√©se');
    
    let rolesText = 'Nincs';
    if (userData.roles) {
        try {
            if (typeof userData.roles === 'string') {
                const roles = JSON.parse(userData.roles);
                rolesText = Array.isArray(roles) ? roles.join(', ') : roles;
            } else if (Array.isArray(userData.roles)) {
                rolesText = userData.roles.join(', ');
            }
        } catch (e) {
            console.error('Hiba a rangok feldolgoz√°s√°ban:', e);
        }
    }
    
    const detailsHTML = `
        <div style="line-height: 1.6;">
            <strong>Profil adatok</strong><br><br>
            <strong>N√©v:</strong> ${userData.full_name || userData.first_name || 'N/A'}<br>
            <strong>Alias:</strong> ${userData.alias || 'N/A'}<br>
            <strong>Email:</strong> ${userData.email || 'N/A'}<br>
            <strong>Rangok:</strong> ${rolesText}<br>
            <strong>UID:</strong> ${userData.uid || 'N/A'}<br>
            <strong>Profilk√©p URL:</strong> ${userData.pfp || 'Nincs'}<br>
        </div>
    `;
    
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    `;
    
    modal.innerHTML = `
        <div style="background: white; padding: 25px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                <h3 style="margin: 0; color: #1891d1;">Profil adatok</h3>
                <button id="close-modal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">√ó</button>
            </div>
            ${detailsHTML}
            <div style="margin-top: 25px; text-align: right; border-top: 1px solid #eee; padding-top: 15px;">
                <button id="close-modal-btn" style="padding: 10px 20px; background: #1891d1; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">Bez√°r√°s</button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    document.getElementById('close-modal').addEventListener('click', () => {
        console.log('Modal bez√°rva');
        modal.remove();
    });
    
    document.getElementById('close-modal-btn').addEventListener('click', () => {
        console.log('Modal bez√°rva gombbal');
        modal.remove();
    });
    
    // Kattint√°s a modalon k√≠v√ºl
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            console.log('Modal bez√°rva kattint√°ssal k√≠v√ºl');
            modal.remove();
        }
    });
    
    // ESC billenty≈±
    document.addEventListener('keydown', function closeOnEsc(e) {
        if (e.key === 'Escape') {
            console.log('Modal bez√°rva ESC billenty≈±vel');
            modal.remove();
            document.removeEventListener('keydown', closeOnEsc);
        }
    });
}

function editProfile(userData) {
    alert('Profil szerkeszt√©se hamarosan el√©rhet≈ë lesz.\n\nFelhaszn√°l√≥: ' + (userData.alias || userData.full_name || userData.first_name || 'Ismeretlen'));
}

window.testProfileLoad = function() {
    console.log('=== MANU√ÅLIS PROFIL TESZT ===');
    loadUserProfile();
};

setTimeout(() => {
    console.log('Automatikus √∫jrapr√≥b√°lkoz√°s...');
    loadUserProfile();
}, 2000);
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // √öj poszt gomb
    document.getElementById('new-article-btn')?.addEventListener('click', function() {
        // Form reset
        const form = document.getElementById('post-form');
        if (form) {
            form.reset();
            form.style.display = 'block';
            document.querySelector('.success-message')?.remove();
            document.getElementById('edit-pid')?.remove();
        }
    });
    
    // Cikkeim oldal bet√∂lt√©se
    if (window.location.hash === '#articles') {
        setTimeout(() => {
            document.querySelector('[data-target="articles"]').click();
        }, 500);
    }
});





        async function displayAuthors(authorIds) {
            const container = document.getElementById('authors-container');
            
            if (!authorIds || !Array.isArray(authorIds) || authorIds.length === 0) {
                container.innerHTML = `
                    <div style="color: #718096; font-style: italic;">
                        Nincsenek szerz≈ëk
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            // Minden szerz≈ëh√∂z
            for (const authorId of authorIds) {
                const authorInfo = allUsers[authorId];
                let displayName = `UID: ${authorId}`;
                let isCurrentUser = false;
                
                // Ha van felhaszn√°l√≥ adat
                if (authorInfo) {
                    displayName = authorInfo.alias || authorInfo.full_name || authorInfo.email || displayName;
                    
                    // Ellen≈ërizz√ºk, hogy ez a jelenlegi felhaszn√°l√≥-e
                    if (currentUser && currentUser.uid == authorId) {
                        isCurrentUser = true;
                    }
                }
                
                html += `
                    <div class="author-chip ${isCurrentUser ? 'current-author' : ''}">
                        <ion-icon name="person-outline"></ion-icon>
                        ${displayName}
                        ${isCurrentUser ? '<small style="margin-left: 5px; opacity: 0.9;">(√©n)</small>' : ''}
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
</script>
</body>
</html>