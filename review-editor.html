<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lektor√°l√°s - Poszt szerkeszt√©se</title>
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <style>
        /* Alap st√≠lusok */
        .review-editor-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .editor-header h1 {
            color: #1891d1;
            margin: 0;
            font-size: 28px;
        }
        
        .editor-actions {
            display: flex;
            gap: 10px;
        }
        
        .editor-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .editor-main {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .editor-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .info-card, .history-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .info-card h3, .history-card h3 {
            color: #1891d1;
            margin-top: 0;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 18px;
        }
        
        .info-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .info-label {
            font-weight: bold;
            color: #666;
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .info-value {
            color: #333;
            font-size: 15px;
        }
        
        /* ≈∞rlap st√≠lusok */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #2d3748;
            font-size: 15px;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1891d1;
            box-shadow: 0 0 0 3px rgba(24, 145, 209, 0.1);
            background: white;
        }
        
        textarea.form-control {
            min-height: 250px;
            resize: vertical;
            line-height: 1.6;
        }
        
        /* Kateg√≥ria chip-ek */
        .category-chip {
            display: inline-flex;
            align-items: center;
            background: #1891d1;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            margin: 4px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .category-chip ion-icon {
            margin-right: 6px;
            font-size: 16px;
        }
        
        /* Szerz≈ëk st√≠lusok */
        .author-chip {
            display: inline-flex;
            align-items: center;
            background: #4a6cf7;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            margin: 4px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .author-chip ion-icon {
            margin-right: 6px;
            font-size: 16px;
        }
        
        .current-author {
            background: #20c997;
        }
        
        /* Toolbar */
        .editor-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
            border: 1px solid #e2e8f0;
        }
        
        .toolbar-btn {
            padding: 8px 14px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .toolbar-btn:hover {
            background: #1891d1;
            color: white;
            border-color: #1891d1;
        }
        
        /* Diff view */
        .diff-view {
            margin-top: 30px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }
        
        .diff-header {
            background: #f8f9fa;
            padding: 16px 20px;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .diff-content {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            background: #fafafa;
        }
        
        .diff-line {
            margin-bottom: 10px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .diff-added {
            background: #d4edda;
            color: #155724;
            padding: 4px 6px;
            border-radius: 4px;
            margin: 2px 0;
        }
        
        .diff-removed {
            background: #f8d7da;
            color: #721c24;
            padding: 4px 6px;
            text-decoration: line-through;
            border-radius: 4px;
            margin: 2px 0;
        }
        
        /* Gombok */
        .back-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .back-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px solid #e2e8f0;
        }
        
        .action-buttons button {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: #1891d1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1477ad;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #20c997;
            color: white;
        }
        
        .btn-success:hover {
            background: #1aa179;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        /* Gyors m≈±veletek */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .quick-actions button {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .quick-actions .btn-view {
            background: #17a2b8;
            color: white;
        }
        
        .quick-actions .btn-view:hover {
            background: #138496;
        }
        
        /* Bet√∂lt√©s */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .loading ion-icon {
            font-size: 48px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
            color: #1891d1;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Reszponz√≠v */
        @media (max-width: 992px) {
            .editor-content {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .editor-header {
                flex-direction: column;
                gap: 20px;
                align-items: flex-start;
            }
            
            .editor-actions {
                width: 100%;
            }
            
            .back-btn {
                width: 100%;
                justify-content: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .editor-main, .info-card, .history-card {
                padding: 20px;
            }
        }
        
        @media (max-width: 576px) {
            .review-editor-container {
                padding: 15px;
            }
            
            .editor-header h1 {
                font-size: 24px;
            }
        }

        /* Hozz√°ad√°s a l√©tez≈ë st√≠lusokhoz */
.review-block:hover {
    border-color: #1891d1;
    box-shadow: 0 2px 8px rgba(24, 145, 209, 0.1);
}

#block-editor-container {
    background: #f8f9fa;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 20px;
    min-height: 300px;
}

.block-type-badge {
    background: #4a6cf7;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    margin-bottom: 10px;
}


/* Drag & Drop st√≠lusok */
.draggable-block.dragging {
    opacity: 0.5;
    transform: rotate(2deg);
}

.draggable-block.drag-over {
    box-shadow: 0 0 0 2px #1891d1;
    background: #f0f9ff;
}

.drag-handle:hover {
    background: #e2e8f0;
    cursor: grab;
}

.drag-handle:active {
    cursor: grabbing;
}

/* Edit modal st√≠lusok */
.edit-block-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
}

.edit-block-modal.active {
    opacity: 1;
    visibility: visible;
}

.edit-block-modal-content {
    background: white;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    transform: translateY(-20px);
    transition: transform 0.3s;
}

.edit-block-modal.active .edit-block-modal-content {
    transform: translateY(0);
}

.edit-block-modal-header {
    padding: 20px;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    align-items: center;
    gap: 12px;
    border-left: 4px solid #1891d1;
}

.edit-block-modal-header ion-icon {
    font-size: 24px;
    color: #1891d1;
}

.edit-block-modal-header h3 {
    margin: 0;
    flex: 1;
    color: #2d3748;
}

.edit-block-modal-header .close-edit-modal {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #718096;
    line-height: 1;
}

.edit-block-form {
    padding: 20px;
}

.edit-block-modal-footer {
    padding: 20px;
    border-top: 1px solid #e2e8f0;
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

/* Anim√°ci√≥k */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.review-block {
    animation: fadeIn 0.3s ease-out;
}

/* Gomb hover efektek */
.block-action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.save-blocks-btn:hover {
    box-shadow: 0 4px 8px rgba(32, 201, 151, 0.3);
}
/* A megl√©v≈ë st√≠lusokhoz hozz√°adva */

/* Confirm modal st√≠lusok */
.confirm-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    transition: opacity 0.3s;
}

.confirm-modal.active {
    opacity: 1;
}

.confirm-modal-content {
    background: white;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    transform: translateY(-20px);
    transition: transform 0.3s;
}

.confirm-modal.active .confirm-modal-content {
    transform: translateY(0);
}

.confirm-modal-header {
    padding: 20px;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    align-items: center;
    gap: 12px;
}

.confirm-modal-header ion-icon {
    font-size: 24px;
    color: #1891d1;
}

.confirm-modal-header h3 {
    margin: 0;
    flex: 1;
    color: #2d3748;
}

.confirm-modal-header .close-modal-btn {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #718096;
    line-height: 1;
}

.confirm-modal-body {
    padding: 20px;
}

.confirm-modal-body p {
    margin: 0 0 15px 0;
    color: #4a5568;
    line-height: 1.5;
}

.confirm-modal-body .sub-message {
    color: #718096;
    font-size: 14px;
}

.details-list {
    margin-top: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #e2e8f0;
}

.detail-item:last-child {
    border-bottom: none;
}

.detail-item .label {
    font-weight: 500;
    color: #4a5568;
}

.detail-item .value {
    color: #2d3748;
    max-width: 60%;
    text-align: right;
    word-break: break-word;
}

.confirm-modal-footer {
    padding: 20px;
    border-top: 1px solid #e2e8f0;
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

/* Blokk n√©zet st√≠lusok */
.review-block:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

#block-editor-container {
    background: #f8f9fa;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 20px;
    min-height: 300px;
    margin-bottom: 20px;
}
    </style>

    <style>
    /* Gyors jav√≠t√°s a hib√°s SVG k√©r√©sek elker√ºl√©s√©re */
    ion-icon {
        --ionicon-stroke-width: 32px;
    }
    
    /* Lok√°lis fallback ikonok */
    .ionicon-fallback {
        font-family: 'Arial', sans-serif;
        font-weight: bold;
        color: #666;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        background: #f0f0f0;
        border-radius: 4px;
        margin-right: 8px;
    }
    
    /* Blokk t√≠pus ikonok fallback-el */
    .block-icon-fallback {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        background: #4a6cf7;
        color: white;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        margin-right: 8px;
    }
    
    .block-icon-fallback.paragraph::before { content: "¬∂"; }
    .block-icon-fallback.heading::before { content: "H"; }
    .block-icon-fallback.image::before { content: "üñº"; }
    .block-icon-fallback.quote::before { content: "‚ùù"; }
    .block-icon-fallback.list::before { content: "‚Ä¢"; }
    .block-icon-fallback.code::before { content: "</>"; }
    .block-icon-fallback.divider::before { content: "‚Äî"; }
    .block-icon-fallback.embed::before { content: "üîó"; }



    .image-preview-container {
    transition: all 0.3s ease;
    cursor: pointer;
}

.image-preview-container:hover {
    border-color: #1891d1;
    box-shadow: 0 4px 8px rgba(24, 145, 209, 0.1);
    transform: translateY(-2px);
}

.image-preview-container:hover img {
    opacity: 0.9;
}

.image-loading {
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { opacity: 0.6; }
    50% { opacity: 0.8; }
    100% { opacity: 0.6; }
}

/* 8. K√©p el≈ën√©zet az √©rint≈ë eszk√∂z√∂k√∂n */
@media (hover: hover) {
    .image-preview-container:hover {
        box-shadow: 0 6px 12px rgba(24, 145, 209, 0.15);
    }
}

/* 9. Gomb st√≠lusok a lightbox-hoz */
.lightbox-actions button,
.lightbox-actions a {
    text-decoration: none;
    border: none;
    border-radius: 8px;
    padding: 12px 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.3s;
    font-family: 'Poppins', sans-serif;
}

.lightbox-actions .btn-secondary {
    background: #6c757d;
    color: white;
}

.lightbox-actions .btn-secondary:hover {
    background: #5a6268;
}

.lightbox-actions .btn-primary {
    background: #1891d1;
    color: white;
}

.lightbox-actions .btn-primary:hover {
    background: #1477ad;
}
</style>
</head>
<body>
    <div class="review-editor-container">
        <!-- Fejl√©c -->
        <div class="editor-header">
            <div>
                <h1 id="editor-title">Poszt szerkeszt√©se</h1>
                <p id="editor-subtitle" style="color: #718096; margin-top: 8px; font-size: 14px;">
                    ID: <span id="post-id" style="font-weight: 500;">...</span> ‚Ä¢ 
                    <span id="post-status-badge" style="background: #ffc107; color: #856404; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                        F√ºgg≈ëben
                    </span>
                </p>
            </div>
            <div class="editor-actions">
                <a href="dashboard.html#reviews" class="back-btn">
                    <ion-icon name="arrow-back-outline"></ion-icon>
                    Vissza a lektor√°l√°shoz
                </a>
            </div>
        </div>
        
        <!-- Tartalom -->
        <div class="editor-content">
            <!-- Bal oldal: Szerkeszt≈ë -->
            <div class="editor-main">
                <!-- Bet√∂lt√©s √°llapot -->
                <div class="loading" id="loading" style="display: none;">
                    <ion-icon name="sync-outline"></ion-icon>
                    <p>Adatok bet√∂lt√©se...</p>
                </div>
                
                <!-- ≈∞rlap -->
                <form id="review-edit-form" style="display: none;">
                    <div class="form-group">
                        <label for="edit-title">C√≠m</label>
                        <input type="text" id="edit-title" class="form-control" placeholder="Poszt c√≠me..." required>
                    </div>
                    
                    <div class="form-group">
                        <label>Kateg√≥ria</label>
                        <div id="category-display" style="
                            padding: 15px;
                            background: #f8f9fa;
                            border-radius: 8px;
                            border: 1px solid #e2e8f0;
                            min-height: 50px;
                            display: flex;
                            flex-wrap: wrap;
                            align-items: center;
                            gap: 8px;
                        ">
                            <div style="color: #718096; font-style: italic;">
                                Kateg√≥ria bet√∂lt√©se...
                            </div>
                        </div>
                        <input type="hidden" id="edit-category">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-excerpt">R√∂vid le√≠r√°s</label>
                        <textarea id="edit-excerpt" class="form-control" rows="3" 
                                  placeholder="R√∂vid √∂sszefoglal√≥ a posztr√≥l..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-content">Tartalom</label>
                        <div class="editor-toolbar">
                            

                            <button type="button" class="toolbar-btn" onclick="toggleBlockView()" id="block-view-toggle">
        <ion-icon name="grid-outline"></ion-icon>
        <span style="font-family: 'Abril Fatface'; font-size: 14px">Blokkos n√©zet</span>
    </button>
                        </div>
                        <div id="block-editor-container" style="display: none; margin-top: 20px;">
    <div id="no-blocks-message" style="
        text-align: center;
        padding: 40px 20px;
        color: #718096;
        border: 2px dashed #e2e8f0;
        border-radius: 8px;
        margin-bottom: 20px;
    ">
        <ion-icon name="cube-outline" style="font-size: 48px; margin-bottom: 16px;"></ion-icon>
        <h3 style="margin: 0 0 10px 0; color: #4a5568;">Blokkos szerkeszt≈ë</h3>
        <p>Itt jelennek majd meg a poszt blokkjai.</p>
    </div>
</div>

<textarea id="edit-content" class="form-control" rows="15" 
          placeholder="√çrd ide a poszt tartalm√°t..."></textarea>
                    </div>
                    
                    <!-- V√°ltoztat√°sok -->
                    <div class="diff-view" id="diff-container" style="display: none;">
                        <div class="diff-header">
                            <ion-icon name="git-compare-outline"></ion-icon>
                            V√°ltoztat√°sok √∂sszehasonl√≠t√°sa
                        </div>
                        <div class="diff-content" id="diff-content">
                            <!-- Diff tartalom j√∂n ide -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-notes">Megjegyz√©sek a szerkeszt√©shez (opcion√°lis)</label>
                        <textarea id="edit-notes" class="form-control" rows="3" 
                                  placeholder="Ide √≠rhatod a szerkeszt√©ssel kapcsolatos megjegyz√©seidet..."></textarea>
                    </div>
                    
                    <!-- M≈±veleti gombok -->
                    <div class="action-buttons">
                        <button type="button" class="btn-danger" onclick="rejectPost()">
                            <ion-icon name="close-outline"></ion-icon>
                            Elutas√≠t√°s
                        </button>
                        <button type="button" class="btn-secondary" onclick="saveDraft()">
                            <ion-icon name="save-outline"></ion-icon>
                            Ment√©s v√°zlatk√©nt
                        </button>
                        <button type="submit" class="btn-success">
                            <ion-icon name="checkmark-outline"></ion-icon>
                            Ment√©s √©s elfogad√°s
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Jobb oldal: Inform√°ci√≥k -->
            <div class="editor-sidebar">
                <!-- Poszt inform√°ci√≥k -->
                <div class="info-card">
                    <h3>Poszt inform√°ci√≥k</h3>
                    <div class="info-item">
                        <span class="info-label">Lapsz√°m:</span>
                        <span class="info-value" id="info-number">...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">St√°tusz:</span>
                        <span class="info-value">
                            <span id="info-status" style="
                                background: #ffc107; 
                                color: #856404; 
                                padding: 4px 12px; 
                                border-radius: 20px;
                                font-size: 13px;
                                font-weight: 500;
                            ">F√ºgg≈ëben</span>
                        </span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">L√©trehozva:</span>
                        <span class="info-value" id="info-created">...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Utols√≥ szerkeszt√©s:</span>
                        <span class="info-value" id="info-last-edited">M√©g nem</span>
                    </div>
                </div>
                
                <!-- Szerz≈ëk -->
                <div class="info-card">
                    <h3>Szerz≈ëk</h3>
                    <div id="authors-container" style="
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 8px;
                        border: 1px solid #e2e8f0;
                        min-height: 50px;
                        display: flex;
                        flex-wrap: wrap;
                        gap: 8px;
                    ">
                        <div style="color: #718096; font-style: italic;">
                            Szerz≈ëk bet√∂lt√©se...
                        </div>
                    </div>
                </div>
                
                <!-- Gyors m≈±veletek -->
                <div class="info-card">
                    <h3>Gyors m≈±veletek</h3>
                    <div class="quick-actions">

                        <button type="button" class="btn-danger" onclick="deletePost()">
                            <ion-icon name="trash-outline"></ion-icon>
                            Poszt t√∂rl√©se
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- K√©pfelt√∂lt≈ë Modal -->
<div id="image-upload-modal" class="image-upload-modal" style="display: none;">
    <div class="image-upload-modal-content">
        <div class="image-upload-modal-header">
            <h3>
                <ion-icon name="cloud-upload-outline"></ion-icon>
                K√©p felt√∂lt√©se
            </h3>
            <button class="close-image-upload-modal">√ó</button>
        </div>
        
        <div class="image-upload-modal-body">
            <!-- URL beilleszt√©s -->
            <div class="form-group">
                <label>K√©p URL beilleszt√©se</label>
                <div style="display: flex; gap: 10px;">
                    <input type="url" id="image-url-input" class="form-control" 
                           placeholder="https://example.com/image.jpg">
                    <button type="button" class="toolbar-btn" onclick="useImageFromUrl()">
                        <ion-icon name="link-outline"></ion-icon>
                        Haszn√°l
                    </button>
                </div>
                <small style="color: #6c757d; display: block; margin-top: 5px;">
                    Egyszer≈±en m√°sold be a k√©p URL-j√©t (pl. helyi f√°jl, k√ºls≈ë forr√°s)
                </small>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <div style="font-weight: 500; color: #495057; margin-bottom: 10px;">VAGY</div>
            </div>
            
            <!-- F√°jlfelt√∂lt√©s -->
            <div class="form-group">
                <label>K√©p felt√∂lt√©se sz√°m√≠t√≥g√©pr≈ël</label>
                <div id="image-drop-zone" style="
                    border: 2px dashed #1891d1;
                    border-radius: 8px;
                    padding: 40px 20px;
                    text-align: center;
                    background: #f8fafc;
                    cursor: pointer;
                    transition: all 0.3s;
                ">
                    <ion-icon name="images-outline" style="
                        font-size: 48px;
                        color: #1891d1;
                        margin-bottom: 15px;
                        display: block;
                    "></ion-icon>
                    <h4 style="margin: 0 0 10px 0; color: #2d3748;">
                        H√∫zd ide a k√©pet, vagy kattints a tall√≥z√°shoz
                    </h4>
                    <p style="color: #718096; margin: 0 0 20px 0;">
                        T√°mogatott form√°tumok: JPG, PNG, GIF, WebP
                    </p>
                    <button type="button" class="toolbar-btn" onclick="document.getElementById('image-file-input').click()">
                        <ion-icon name="folder-open-outline"></ion-icon>
                        K√©p kiv√°laszt√°sa
                    </button>
                </div>
                <input type="file" id="image-file-input" accept="image/*" style="display: none;">
            </div>
            
            <!-- El≈ën√©zet -->
            <div id="upload-preview-container" style="
                margin-top: 20px;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 8px;
                border: 1px solid #e2e8f0;
                display: none;
            ">
                <h4 style="margin-top: 0; margin-bottom: 10px; color: #495057;">El≈ën√©zet</h4>
                <div id="upload-preview" style="
                    max-width: 100%;
                    max-height: 200px;
                    overflow: hidden;
                    text-align: center;
                    margin-bottom: 15px;
                ">
                    <!-- Itt jelenik meg az el≈ën√©zet -->
                </div>
                <div style="display: flex; gap: 10px; justify-content: space-between; align-items: center;">
                    <span id="upload-file-name" style="
                        font-size: 12px;
                        color: #6c757d;
                        word-break: break-all;
                        flex: 1;
                    "></span>
                    <button type="button" class="toolbar-btn" onclick="uploadSelectedImage()" 
                            style="background: #20c997; color: white; border-color: #20c997;">
                        <ion-icon name="cloud-upload-outline"></ion-icon>
                        Felt√∂lt√©s
                    </button>
                </div>
            </div>
            
            <!-- Felt√∂lt√©si √°llapot -->
            <div id="upload-progress" style="display: none;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <ion-icon name="sync-outline" style="
                        font-size: 20px;
                        color: #1891d1;
                        animation: spin 1s linear infinite;
                    "></ion-icon>
                    <span style="color: #495057;">Felt√∂lt√©s folyamatban...</span>
                </div>
                <div style="
                    height: 6px;
                    background: #e2e8f0;
                    border-radius: 3px;
                    overflow: hidden;
                ">
                    <div id="upload-progress-bar" style="
                        height: 100%;
                        background: #1891d1;
                        width: 0%;
                        transition: width 0.3s;
                    "></div>
                </div>
            </div>
        </div>
        
        <div class="image-upload-modal-footer">
            <button type="button" class="btn-secondary" onclick="closeImageUploader()">
                <ion-icon name="close-outline"></ion-icon>
                M√©gse
            </button>
        </div>
    </div>
</div>

<script>
// K√©pfelt√∂lt≈ë modal megnyit√°sa
function openImageUploader() {
    const modal = document.getElementById('image-upload-modal');
    modal.style.display = 'block';
    
    // Reset √°llapot
    resetImageUploader();
    
    // Esem√©nykezel≈ëk
    setupImageUploadEvents();
    
    // ESC bez√°r√°s
    document.addEventListener('keydown', function onEsc(e) {
        if (e.key === 'Escape') closeImageUploader();
    });
}

// K√©pfelt√∂lt≈ë bez√°r√°sa
function closeImageUploader() {
    const modal = document.getElementById('image-upload-modal');
    modal.style.display = 'none';
    resetImageUploader();
}

// K√©pfelt√∂lt≈ë reset
function resetImageUploader() {
    document.getElementById('image-url-input').value = '';
    document.getElementById('image-file-input').value = '';
    document.getElementById('upload-preview-container').style.display = 'none';
    document.getElementById('upload-progress').style.display = 'none';
    document.getElementById('upload-progress-bar').style.width = '0%';
    document.getElementById('upload-preview').innerHTML = '';
    document.getElementById('upload-file-name').textContent = '';
}

// K√©p haszn√°lata URL-b≈ël
function useImageFromUrl() {
    const urlInput = document.getElementById('image-url-input');
    const imageUrl = urlInput.value.trim();
    
    if (!imageUrl) {
        alert('K√©rlek adj meg egy √©rv√©nyes URL-t!');
        return;
    }
    
    // Ellen≈ërizz√ºk, hogy k√©p URL-e
    if (!isValidImageUrl(imageUrl)) {
        alert('Az URL nem egy √©rv√©nyes k√©pf√°jlra mutat!');
        return;
    }
    
    // Tesztelj√ºk a k√©pet
    testImageUrl(imageUrl).then(isValid => {
        if (isValid) {
            // K√©p haszn√°lata a szerkeszt≈ëben
            useImageInEditor(imageUrl);
            closeImageUploader();
        } else {
            alert('Nem lehet bet√∂lteni a k√©pet ebb≈ël az URL-b≈ël!');
        }
    }).catch(() => {
        alert('Hiba t√∂rt√©nt a k√©p ellen≈ërz√©se sor√°n!');
    });
}

// K√©p URL valid√°l√°sa
function isValidImageUrl(url) {
    const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp', '.svg'];
    const lowerUrl = url.toLowerCase();
    return imageExtensions.some(ext => lowerUrl.includes(ext)) || 
           lowerUrl.includes('data:image/') ||
           lowerUrl.includes('blob:');
}

// K√©p URL tesztel√©se
function testImageUrl(url) {
    return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => resolve(true);
        img.onerror = () => resolve(false);
        img.src = url;
        
        // Timeout
        setTimeout(() => resolve(false), 5000);
    });
}

// K√©p haszn√°lata a szerkeszt≈ëben
function useImageInEditor(imageUrl) {
    // Megkeress√ºk a k√©p URL mez≈ët a szerkeszt≈ëben
    const editModal = document.querySelector('.edit-block-modal.active');
    if (!editModal) return;
    
    const urlInput = editModal.querySelector('[name="image-url"]');
    if (urlInput) {
        urlInput.value = imageUrl;
        
        // El≈ën√©zet friss√≠t√©se
        updateImagePreview(urlInput);
        
        // Sikeres √ºzenet
        showSuccessNotification('K√©p URL beillesztve!', 'success');
    }
}

// K√©pfelt√∂lt√©s esem√©nykezel≈ëk
function setupImageUploadEvents() {
    const dropZone = document.getElementById('image-drop-zone');
    const fileInput = document.getElementById('image-file-input');
    
    // Drag and drop
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.background = '#e8f4fd';
        dropZone.style.borderColor = '#1891d1';
    });
    
    dropZone.addEventListener('dragleave', () => {
        dropZone.style.background = '#f8fafc';
        dropZone.style.borderColor = '#1891d1';
    });
    
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.background = '#f8fafc';
        dropZone.style.borderColor = '#1891d1';
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleImageFile(files[0]);
        }
    });
    
    // F√°jl kiv√°laszt√°s
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleImageFile(e.target.files[0]);
        }
    });
}

// K√©pf√°jl kezel√©se
function handleImageFile(file) {
    // Ellen≈ërz√©s
    if (!file.type.startsWith('image/')) {
        alert('K√©rlek k√©pf√°jlt v√°lassz!');
        return;
    }
    
    if (file.size > 10 * 1024 * 1024) { // 10MB limit
        alert('A k√©p t√∫l nagy! Maximum 10MB lehet.');
        return;
    }
    
    // El≈ën√©zet
    const reader = new FileReader();
    reader.onload = function(e) {
        const previewContainer = document.getElementById('upload-preview-container');
        const preview = document.getElementById('upload-preview');
        const fileName = document.getElementById('upload-file-name');
        
        preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 180px; border-radius: 4px;" alt="El≈ën√©zet">`;
        fileName.textContent = file.name;
        previewContainer.style.display = 'block';
        
        // Automatikus g√∂rget√©s az el≈ën√©zethez
        previewContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    };
    reader.readAsDataURL(file);
}

// K√©p felt√∂lt√©se a szerverre
async function uploadSelectedImage() {
    const fileInput = document.getElementById('image-file-input');
    if (!fileInput.files.length) {
        alert('Nincs k√©p kiv√°lasztva!');
        return;
    }
    
    const file = fileInput.files[0];
    const formData = new FormData();
    formData.append('image', file);
    formData.append('post_id', postId);
    
    // Felt√∂lt√©si √°llapot megjelen√≠t√©se
    document.getElementById('upload-progress').style.display = 'block';
    document.getElementById('upload-progress-bar').style.width = '30%';
    
    try {
        const token = getAuthToken();
        const response = await fetch('/api/upload/image', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`
                // 'Content-Type' nem kell, FormData automatikusan be√°ll√≠tja
            },
            body: formData
        });
        
        document.getElementById('upload-progress-bar').style.width = '70%';
        
        if (response.ok) {
            const result = await response.json();
            document.getElementById('upload-progress-bar').style.width = '100%';
            
            if (result.url) {
                // Sikeres felt√∂lt√©s - k√©p haszn√°lata a szerkeszt≈ëben
                setTimeout(() => {
                    useImageInEditor(result.url);
                    closeImageUploader();
                    showSuccessNotification('K√©p sikeresen felt√∂ltve!', 'success');
                }, 500);
            } else {
                throw new Error('Nem √©rkezett URL a szerverr≈ël');
            }
        } else {
            throw new Error(`Felt√∂lt√©si hiba: ${response.status}`);
        }
    } catch (error) {
        console.error('Hiba a k√©p felt√∂lt√©se sor√°n:', error);
        document.getElementById('upload-progress-bar').style.background = '#e74c3c';
        showSuccessNotification('Hiba t√∂rt√©nt a felt√∂lt√©s sor√°n!', 'error');
        
        // Vissza√°ll√≠t√°s 3 m√°sodperc m√∫lva
        setTimeout(() => {
            document.getElementById('upload-progress').style.display = 'none';
            document.getElementById('upload-progress-bar').style.width = '0%';
            document.getElementById('upload-progress-bar').style.background = '#1891d1';
        }, 3000);
    }
}

// K√©p el≈ën√©zet friss√≠t√©se
function updateImagePreview(urlInput) {
    const imageUrl = urlInput.value.trim();
    const previewContainer = document.getElementById('image-preview-container');
    const preview = document.getElementById('image-preview');
    const urlDisplay = document.getElementById('image-url-display');
    
    if (imageUrl && isValidImageUrl(imageUrl)) {
        preview.innerHTML = `<img src="${imageUrl}" style="max-width: 100%; max-height: 180px; border-radius: 4px;" alt="El≈ën√©zet">`;
        urlDisplay.textContent = imageUrl;
        previewContainer.style.display = 'block';
    } else {
        previewContainer.style.display = 'none';
    }
}

// K√©p URL input esem√©nykezel≈ë hozz√°ad√°sa (a modal l√©trehoz√°sakor)
function setupImageUrlInputListener() {
    const editModal = document.querySelector('.edit-block-modal.active');
    if (!editModal) return;
    
    const urlInput = editModal.querySelector('[name="image-url"]');
    if (urlInput) {
        urlInput.addEventListener('input', function() {
            updateImagePreview(this);
        });
    }
}

// St√≠lusok hozz√°ad√°sa
const uploaderStyle = document.createElement('style');
uploaderStyle.textContent = `
    .image-upload-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10001;
        animation: fadeIn 0.3s ease-out;
    }
    
    .image-upload-modal-content {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        animation: slideUp 0.3s ease-out;
    }
    
    .image-upload-modal-header {
        padding: 20px;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .image-upload-modal-header h3 {
        margin: 0;
        color: #2d3748;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .image-upload-modal-header .close-image-upload-modal {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #718096;
        line-height: 1;
    }
    
    .image-upload-modal-body {
        padding: 20px;
    }
    
    .image-upload-modal-footer {
        padding: 20px;
        border-top: 1px solid #e2e8f0;
        text-align: right;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
`;
document.head.appendChild(uploaderStyle);
</script>
    <script>
        // URL param√©terek
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('pid');
        const reviewType = urlParams.get('type') || 'pending';
        
        // Glob√°lis v√°ltoz√≥k
        let originalPost = null;
        let currentUser = null;
        let allUsers = {}; // √ñsszes felhaszn√°l√≥ adatai
        let allCategories = []; // √ñsszes kateg√≥ria
        
        // Bet√∂lt√©s ut√°n
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Review editor bet√∂ltve');
            console.log('Post ID:', postId);
            console.log('Review type:', reviewType);
            
            if (!postId) {
                alert('Nincs poszt ID megadva!');
                window.location.href = 'dashboard.html#reviews';
                return;
            }
            
            // Bet√∂lt√©s megjelen√≠t√©se
            showLoading(true);
            
            // Be√°ll√≠tjuk a c√≠mben a poszt ID-t
            document.getElementById('post-id').textContent = postId;
            
            try {
                // 1. Felhaszn√°l√≥ bet√∂lt√©se
                await loadCurrentUser();
                
                // 2. √ñsszes felhaszn√°l√≥ bet√∂lt√©se (szerz≈ëk neveihez)
                await loadAllUsers();
                
                // 3. Kateg√≥ri√°k bet√∂lt√©se
                await loadCategories();
                
                // 4. Poszt bet√∂lt√©se
                await loadPostData();
                
                // 5. ≈∞rlap esem√©nykezel≈ë
                document.getElementById('review-edit-form').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await saveAndApprove();
                });
                
                // ≈∞rlap megjelen√≠t√©se
                document.getElementById('review-edit-form').style.display = 'block';
                showLoading(false);
                
            } catch (error) {
                console.error('Hiba a bet√∂lt√©s sor√°n:', error);
                alert(`Hiba t√∂rt√©nt: ${error.message}`);
                window.location.href = 'dashboard.html#reviews';
            }
        });
        
        // Felhaszn√°l√≥ bet√∂lt√©se
        async function loadCurrentUser() {
            try {
                const token = getAuthToken();
                if (!token) {
                    throw new Error('Nincs bejelentkezve');
                }
                
                const response = await fetch('/api/user/get', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        get: 'uid, email, alias, full_name, roles'
                    })
                });
                
                if (response.ok) {
                    currentUser = await response.json();
                    console.log('Felhaszn√°l√≥ bet√∂ltve:', currentUser);
                } else {
                    throw new Error('Nem siker√ºlt bet√∂lteni a felhaszn√°l√≥i adatokat');
                }
            } catch (error) {
                console.error('Hiba a felhaszn√°l√≥ bet√∂lt√©se sor√°n:', error);
                throw error;
            }
        }
        
        // √ñsszes felhaszn√°l√≥ bet√∂lt√©se (szerz≈ëk neveihez)
        async function loadAllUsers() {
            try {
                const token = getAuthToken();
                if (!token) return;
                
                const response = await fetch('/api/user/getall', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    allUsers = await response.json();
                    console.log('√ñsszes felhaszn√°l√≥ bet√∂ltve:', allUsers);
                }
            } catch (error) {
                console.error('Hiba a felhaszn√°l√≥k bet√∂lt√©se sor√°n:', error);
            }
        }
        
        // Kateg√≥ri√°k bet√∂lt√©se
        async function loadCategories() {
            try {
                // Itt a kateg√≥ri√°kat kellene bet√∂lteni
                // Jelenleg minta adatokat haszn√°lunk
                allCategories = [
                    'H√≠rek', 'Programoz√°s', 'Tudom√°ny', 'M≈±v√©szet',
                    'Sport', 'Technol√≥gia', 'Eg√©szs√©g', 'Oktat√°s'
                ];
                
                console.log('Kateg√≥ri√°k bet√∂ltve:', allCategories);
            } catch (error) {
                console.error('Hiba a kateg√≥ri√°k bet√∂lt√©se sor√°n:', error);
            }
        }
        
        // Poszt adatok bet√∂lt√©se
      // Poszt adatok bet√∂lt√©se - FRISS√çTVE
// Poszt adatok bet√∂lt√©se - M√ìDOS√çTVE
async function loadPostData() {
    try {
        const token = getAuthToken();
        if (!token) {
            throw new Error('Nincs bejelentkezve');
        }
        
        const edited = reviewType === 'edited';
        
        // 1. PR√ìB√ÅLJUK MEG EL≈êSZ√ñR A NORM√ÅL V√âGPONTOT
        console.log('1. Pr√≥b√°lom lek√©rni a posztot a /api/post/get/contents endpointon...');
        const response = await fetch('/api/post/get/contents', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                post: parseInt(postId),
                edited: edited,
                include_blocks: true // K√©rj√ºk a blokkokat
            })
        });
        
        if (!response.ok) {
            throw new Error(`Hiba a poszt bet√∂lt√©se sor√°n: ${response.status}`);
        }
        
        const postData = await response.json();
        console.log('1. Poszt adatok a /api/post/get/contents endpointr√≥l:', postData);
        
        // 2. HA NINCS BLOCKS_JSON, PR√ìB√ÅLJUK M√ÅSIK V√âGPONTOT
        if (!postData.blocks_json) {
            console.log('2. Nincs blocks_json, pr√≥b√°lom a /api/post/get endpointot...');
            
            try {
                const getResponse = await fetch('/api/post/get', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        post: parseInt(postId),
                        get: 'blocks_json'
                    })
                });
                
                if (getResponse.ok) {
                    const getData = await getResponse.json();
                    console.log('2. Poszt adatok a /api/post/get endpointr√≥l:', getData);
                    
                    // Egyes√≠ts√ºk az adatokat
                    if (getData.blocks_json) {
                        postData.blocks_json = getData.blocks_json;
                    }
                }
            } catch (getError) {
                console.warn('Nem siker√ºlt lek√©rni a blokkokat:', getError);
            }
        }
        
        // 3. HA M√âG MINDIG NINCS BLOCKS_JSON, DE VAN DESC, PR√ìB√ÅLJUK VISSZAALAK√çTANI
        if (!postData.blocks_json && postData.desc) {
            console.log('3. M√©g mindig nincs blocks_json, pr√≥b√°lom visszaalak√≠tani a DESC-b≈ël...');
            try {
                const parsedBlocks = attemptParseBlocksFromDesc(postData.desc);
                if (parsedBlocks) {
                    postData.blocks_json = JSON.stringify(parsedBlocks);
                    console.log('3. Blokkok visszaalak√≠tva a DESC-b≈ël:', parsedBlocks);
                }
            } catch (parseError) {
                console.warn('Nem siker√ºlt visszaalak√≠tani a blokkokat:', parseError);
            }
        }
        
        // 4. V√âG√úL HA SEMMI SEM M≈∞K√ñDIK, K√âRDEZZ√úK MEG A SZERVERR≈êL K√úL√ñN
        if (!postData.blocks_json) {
            console.log('4. Pr√≥b√°lom a /api/post/get/blocks endpointot...');
            try {
                const blocksResponse = await fetch('/api/post/get/blocks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        post: parseInt(postId)
                    })
                });
                
                if (blocksResponse.ok) {
                    const blocksData = await blocksResponse.json();
                    console.log('4. Blokk adatok:', blocksData);
                    
                    if (blocksData.blocks) {
                        postData.blocks_json = JSON.stringify(blocksData.blocks);
                    }
                }
            } catch (blocksError) {
                console.warn('Nem siker√ºlt lek√©rni a blokkokat k√ºl√∂n:', blocksError);
            }
        }
        
        // Elmentj√ºk az eredeti adatokat
        originalPost = { ...postData };
        console.log('V√©gs≈ë poszt adatok:', postData);
        
        // Kit√∂ltj√ºk az ≈±rlapot
        populateForm(postData);
        
        // Kit√∂ltj√ºk az inform√°ci√≥kat
        await populateInfo(postData);
        
        // Diff bet√∂lt√©se (ha van)
        if (edited) {
            await loadDiff();
        }
        
    } catch (error) {
        console.error('Hiba a poszt bet√∂lt√©se sor√°n:', error);
        throw error;
    }
}

/**
 * Pr√≥b√°lja visszaalak√≠tani a blokkokat a DESC HTML-b≈ël
 */
function attemptParseBlocksFromDesc(html) {
    if (!html) return null;
    
    try {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        
        const blocks = [];
        let blockIndex = 0;
        
        // V√©gigj√°rjuk a gyermek elemeket
        Array.from(tempDiv.children).forEach(element => {
            const block = createBlockFromElement(element, blockIndex);
            if (block) {
                blocks.push(block);
                blockIndex++;
            }
        });
        
        return blocks.length > 0 ? blocks : null;
        
    } catch (error) {
        console.error('Hiba a HTML parse sor√°n:', error);
        return null;
    }
}

/**
 * Elemb≈ël blokk l√©trehoz√°sa
 */
function createBlockFromElement(element, index) {
    const tagName = element.tagName.toLowerCase();
    const className = element.className || '';
    
    let block = {
        id: `block_${Date.now()}_${index}`,
        type: '',
        content: '',
        attributes: {},
        styles: {},
        position: index
    };
    
    // D√∂nts√ºk el a blokk t√≠pus√°t
    if (tagName === 'h1' || tagName === 'h2' || tagName === 'h3' || 
        tagName === 'h4' || tagName === 'h5' || tagName === 'h6') {
        block.type = 'heading';
        block.content = element.textContent || '';
        block.attributes.level = tagName;
        
    } else if (tagName === 'p' || className.includes('paragraph')) {
        block.type = 'paragraph';
        block.content = element.innerHTML || '';
        
    } else if (tagName === 'figure' || className.includes('image')) {
        block.type = 'image';
        const img = element.querySelector('img');
        if (img) {
            block.content = img.src || '';
            block.attributes.alt = img.alt || '';
        }
        const figcaption = element.querySelector('figcaption');
        if (figcaption) {
            block.attributes.caption = figcaption.textContent || '';
        }
        
    } else if (tagName === 'blockquote') {
        block.type = 'quote';
        block.content = element.querySelector('p')?.innerHTML || element.innerHTML || '';
        const cite = element.querySelector('cite');
        if (cite) {
            block.attributes.author = cite.textContent.replace('‚Äî', '').trim();
        }
        
    } else if (tagName === 'ul' || tagName === 'ol') {
        block.type = 'list';
        const items = Array.from(element.querySelectorAll('li')).map(li => li.textContent || '');
        block.content = items;
        block.attributes.type = tagName;
        
    } else if (tagName === 'pre') {
        block.type = 'code';
        const code = element.querySelector('code');
        block.content = code ? code.textContent : element.textContent || '';
        if (code && code.className) {
            const langMatch = code.className.match(/language-(\w+)/);
            if (langMatch) {
                block.attributes.language = langMatch[1];
            }
        }
        
    } else if (tagName === 'hr') {
        block.type = 'divider';
        block.content = 'divider';
        
    } else {
        // Ha nem ismert t√≠pus, akkor paragraph-k√©nt kezelj√ºk
        block.type = 'paragraph';
        block.content = element.outerHTML || '';
    }
    
    return block.type ? block : null;
}
        // ≈∞rlap kit√∂lt√©se
        // ≈∞rlap kit√∂lt√©se
// ≈∞rlap kit√∂lt√©se
// ≈∞rlap kit√∂lt√©se - FRISS√çTVE
function populateForm(postData) {
    document.getElementById('edit-title').value = postData.title || '';
    document.getElementById('edit-excerpt').value = postData.minimal_desc || '';
    
    console.log('PopulateForm - poszt adatok:', {
        hasBlocksJson: !!postData.blocks_json,
        blocksJson: postData.blocks_json,
        desc: postData.desc ? postData.desc.substring(0, 100) + '...' : null
    });
    
    // Blokk n√©zet gomb megjelen√≠t√©se mindig, ha van blocks_json
    const blockToggle = document.getElementById('block-view-toggle');
    if (blockToggle && postData.blocks_json) {
        blockToggle.style.display = 'flex';
        
        // Bet√∂ltj√ºk a blokkokat el≈ëre
        displayBlocksFromPost(postData.blocks_json);
    }
    
    // Kateg√≥ria megjelen√≠t√©se
    displayCategory(postData.category);
} 

// Kateg√≥ria megjelen√≠t√©se chip-k√©nt
        function displayCategory(categoryName) {
            const container = document.getElementById('category-display');
            const hiddenInput = document.getElementById('edit-category');
            
            if (!categoryName || categoryName.trim() === '') {
                container.innerHTML = `
                    <div style="color: #718096; font-style: italic;">
                        Nincs kateg√≥ria megadva
                    </div>
                `;
                hiddenInput.value = '';
                return;
            }
            
            container.innerHTML = `
                <div class="category-chip">
                    <ion-icon name="folder-outline"></ion-icon>
                    ${categoryName}
                </div>
            `;
            hiddenInput.value = categoryName;
        }
        
        // Inform√°ci√≥k kit√∂lt√©se
        async function populateInfo(postData) {
            document.getElementById('info-number').textContent = postData.number || 'N/A';
            document.getElementById('info-created').textContent = formatDate(postData.created) || 'N/A';
            
            if (postData.last_edited) {
                document.getElementById('info-last-edited').textContent = formatDate(postData.last_edited);
            }
            
            // Szerz≈ëk megjelen√≠t√©se
            await displayAuthors(postData.authors);
        }
        
        // Szerz≈ëk megjelen√≠t√©se chip-ekk√©nt
        async function displayAuthors(authorIds) {
            const container = document.getElementById('authors-container');
            
            if (!authorIds || !Array.isArray(authorIds) || authorIds.length === 0) {
                container.innerHTML = `
                    <div style="color: #718096; font-style: italic;">
                        Nincsenek szerz≈ëk
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            // Minden szerz≈ëh√∂z
            for (const authorId of authorIds) {
                const authorInfo = allUsers[authorId];
                let displayName = `UID: ${authorId}`;
                let isCurrentUser = false;
                
                // Ha van felhaszn√°l√≥ adat
                if (authorInfo) {
                    displayName = authorInfo.alias || authorInfo.full_name || authorInfo.email || displayName;
                    
                    // Ellen≈ërizz√ºk, hogy ez a jelenlegi felhaszn√°l√≥-e
                    if (currentUser && currentUser.uid == authorId) {
                        isCurrentUser = true;
                    }
                }
                
                html += `
                    <div class="author-chip ${isCurrentUser ? 'current-author' : ''}">
                        <ion-icon name="person-outline"></ion-icon>
                        ${displayName}
                        ${isCurrentUser ? '<small style="margin-left: 5px; opacity: 0.9;">(√©n)</small>' : ''}
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // Diff bet√∂lt√©se
        async function loadDiff() {
            try {
                const token = getAuthToken();
                if (!token) return;
                
                // Lek√©rj√ºk az eredeti verzi√≥t is
                const originalResponse = await fetch('/api/post/get/contents', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        post: parseInt(postId),
                        edited: false
                    })
                });
                
                if (originalResponse.ok) {
                    const originalData = await originalResponse.json();
                    showDiff(originalData, originalPost);
                }
                
            } catch (error) {
                console.error('Hiba a diff bet√∂lt√©se sor√°n:', error);
            }
        }
        
        // Diff megjelen√≠t√©se
        function showDiff(original, edited) {
            const diffContainer = document.getElementById('diff-container');
            const diffContent = document.getElementById('diff-content');
            
            diffContainer.style.display = 'block';
            
            let diffHTML = '';
            
            // C√≠m v√°ltoz√°sok
            if (original.title !== edited.title) {
                diffHTML += `
                    <div class="diff-line">
                        <strong style="color: #2d3748;">C√≠m:</strong><br>
                        <span class="diff-removed">${original.title || '(√ºres)'}</span><br>
                        <span class="diff-added">${edited.title || '(√ºres)'}</span>
                    </div>
                    <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 10px 0;">
                `;
            }
            
            // Kateg√≥ria v√°ltoz√°sok
            if (original.category !== edited.category) {
                diffHTML += `
                    <div class="diff-line">
                        <strong style="color: #2d3748;">Kateg√≥ria:</strong><br>
                        <span class="diff-removed">${original.category || '(nincs)'}</span><br>
                        <span class="diff-added">${edited.category || '(nincs)'}</span>
                    </div>
                    <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 10px 0;">
                `;
            }
            
            // Le√≠r√°s v√°ltoz√°sok (csak els≈ë 100 karakter)
            const origExcerpt = original.minimal_desc || '';
            const editExcerpt = edited.minimal_desc || '';
            if (origExcerpt !== editExcerpt) {
                diffHTML += `
                    <div class="diff-line">
                        <strong style="color: #2d3748;">R√∂vid le√≠r√°s:</strong><br>
                        <span class="diff-removed">${origExcerpt.substring(0, 100)}${origExcerpt.length > 100 ? '...' : ''}</span><br>
                        <span class="diff-added">${editExcerpt.substring(0, 100)}${editExcerpt.length > 100 ? '...' : ''}</span>
                    </div>
                    <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 10px 0;">
                `;
            }
            
            // Tartalom v√°ltoz√°sok (csak els≈ë 300 karakter)
            const origDesc = original.desc || '';
            const editDesc = edited.desc || '';
            if (origDesc !== editDesc) {
                diffHTML += `
                    <div class="diff-line">
                        <strong style="color: #2d3748;">Tartalom (r√©szlet):</strong><br>
                        <span class="diff-removed">${origDesc.substring(0, 300)}${origDesc.length > 300 ? '...' : ''}</span><br>
                        <span class="diff-added">${editDesc.substring(0, 300)}${editDesc.length > 300 ? '...' : ''}</span>
                    </div>
                `;
            }
            
            diffContent.innerHTML = diffHTML || '<p style="color: #718096; text-align: center;">Nincsenek v√°ltoztat√°sok</p>';
        }
        
        // Ment√©s √©s elfogad√°s
async function saveAndApprove() {
    if (!confirm('Biztosan szeretn√©d menteni √©s elfogadni a szerkeszt√©seket?')) {
        return;
    }

    try {
        showLoading(true);
        
        const token = getAuthToken();
        if (!token) {
            throw new Error('Nincs bejelentkezve');
        }
        
        // √ñssze√°ll√≠tjuk a friss√≠tend≈ë adatokat
        const updateData = {
            post: parseInt(postId)
        };
        
        // Csak azokat a mez≈ëket adjuk hozz√°, amik v√°ltoztak
        const title = document.getElementById('edit-title').value;
        const category = document.getElementById('edit-category').value;
        const excerpt = document.getElementById('edit-excerpt').value;
        const notes = document.getElementById('edit-notes').value;
        
        // Tartalom lek√©r√©se - blokk n√©zet alapj√°n
        let content = '';
        const isBlockView = document.getElementById('block-editor-container').style.display !== 'none';
        
        if (isBlockView && window.editorBlocks) {
            // Ha blokk n√©zetben vagyunk, HTML gener√°l√°sa a blokkokb√≥l
            content = generateHTMLFromBlocks();
            // Blokkok JSON is ment√©se
            updateData.blocks_json = JSON.stringify(window.editorBlocks);
            updateData.content_type = 'blocks';
        } else {
            // Ha sz√∂veges n√©zetben vagyunk
            content = document.getElementById('edit-content').value;
        }
        
        if (title !== originalPost.title) updateData.title = title;
        if (category !== originalPost.category) updateData.category = category;
        if (excerpt !== originalPost.minimal_desc) updateData.minimal_desc = excerpt;
        if (content !== originalPost.desc) updateData.desc = content;
        
        if (Object.keys(updateData).length <= 1) {
            alert('Nincs v√°ltoz√°s a szerkeszt√©sben!');
            showLoading(false);
            return;
        }
        
        // Ha vannak megjegyz√©sek, hozz√°adjuk
        if (notes.trim() !== '') {
            updateData.notes = notes;
        }
        
        console.log('Friss√≠t√©si adatok:', updateData);
        
        // K√ºldj√ºk a szerkeszt√©si k√©relmet
        const editResponse = await fetch('/api/post/edit', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(updateData)
        });
        
        if (!editResponse.ok) {
            const errorText = await editResponse.text();
            throw new Error(`Szerkeszt√©si hiba: ${errorText}`);
        }
        
        // Ha lektor vagy direktor vagyunk, azonnal elfogadjuk
        const roles = currentUser?.roles || [];
        let isEditor = false;
        
        if (typeof roles === 'string') {
            try {
                const parsedRoles = JSON.parse(roles);
                isEditor = Array.isArray(parsedRoles) && 
                    (parsedRoles.includes('lector') || parsedRoles.includes('director') || parsedRoles.includes('*'));
            } catch (e) {
                // Ha nem JSON, akkor sima stringk√©nt kezelj√ºk
                isEditor = roles.includes('lector') || roles.includes('director') || roles.includes('*');
            }
        } else if (Array.isArray(roles)) {
            isEditor = roles.includes('lector') || roles.includes('director') || roles.includes('*');
        }
        
        if (isEditor) {
            const approveResponse = await fetch('/api/post/approve', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ post: parseInt(postId) })
            });
            
            if (approveResponse.ok) {
                alert('Szerkeszt√©s sikeresen mentve √©s a poszt elfogadva!');
                window.location.href = 'dashboard.html#reviews';
            } else {
                const errorText = await approveResponse.text();
                throw new Error(`Elfogad√°si hiba: ${errorText}`);
            }
        } else {
            alert('Szerkeszt√©s sikeresen mentve, elfogad√°sra v√°r!');
            window.location.href = 'dashboard.html#reviews';
        }
        
    } catch (error) {
        console.error('Hiba a ment√©s sor√°n:', error);
        alert(`Hiba t√∂rt√©nt: ${error.message}`);
    } finally {
        showLoading(false);
    }
}

        // V√°zlat ment√©se
        async function saveDraft() {
            try {
                showLoading(true);
                
                const token = getAuthToken();
                if (!token) {
                    throw new Error('Nincs bejelentkezve');
                }
                
                const updateData = {
                    post: parseInt(postId),
                    title: document.getElementById('edit-title').value,
                    category: document.getElementById('edit-category').value,
                    minimal_desc: document.getElementById('edit-excerpt').value,
                    desc: document.getElementById('edit-content').value
                };
                
                const notes = document.getElementById('edit-notes').value;
                if (notes.trim() !== '') {
                    updateData.notes = notes;
                }
                
                const response = await fetch('/api/post/edit', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(updateData)
                });
                
                if (response.ok) {
                    alert('V√°zlat sikeresen mentve!');
                } else {
                    const errorText = await response.text();
                    throw new Error(`Ment√©si hiba: ${errorText}`);
                }
                
            } catch (error) {
                console.error('Hiba a v√°zlat ment√©se sor√°n:', error);
                alert(`Hiba t√∂rt√©nt: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // Poszt elutas√≠t√°sa
        async function rejectPost() {
            if (!confirm('Biztosan elutas√≠tod ezt a posztot? Ez a m≈±velet visszavonhatatlan!')) {
                return;
            }
            
            try {
                showLoading(true);
                
                const token = getAuthToken();
                if (!token) {
                    throw new Error('Nincs bejelentkezve');
                }
                
                // T√∂r√∂lj√ºk a posztot
                const response = await fetch('/api/post/delete', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ post: parseInt(postId) })
                });
                
                if (response.ok) {
                    alert('Poszt sikeresen elutas√≠tva √©s t√∂r√∂lve!');
                    window.location.href = 'dashboard.html#reviews';
                } else {
                    const errorText = await response.text();
                    throw new Error(`Elutas√≠t√°si hiba: ${errorText}`);
                }
                
            } catch (error) {
                console.error('Hiba az elutas√≠t√°s sor√°n:', error);
                alert(`Hiba t√∂rt√©nt: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // Poszt t√∂rl√©se
        async function deletePost() {
            if (!confirm('Biztosan t√∂rl√∂d ezt a posztot? Ez V√âGLEGES √©s visszavonhatatlan!')) {
                return;
            }
            
            try {
                showLoading(true);
                
                const token = getAuthToken();
                if (!token) {
                    throw new Error('Nincs bejelentkezve');
                }
                
                const response = await fetch('/api/post/delete', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ post: parseInt(postId) })
                });
                
                if (response.ok) {
                    alert('Poszt sikeresen t√∂r√∂lve!');
                    window.location.href = 'dashboard.html#reviews';
                } else {
                    const errorText = await response.text();
                    throw new Error(`T√∂rl√©si hiba: ${errorText}`);
                }
                
            } catch (error) {
                console.error('Hiba a t√∂rl√©s sor√°n:', error);
                alert(`Hiba t√∂rt√©nt: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        // Eredeti poszt megtekint√©se
        function viewOriginalPost() {
            window.open(`/post/${postId}`, '_blank');
        }
        
        // Seg√©df√ºggv√©nyek
        function getAuthToken() {
            return localStorage.getItem('secret') || sessionStorage.getItem('secret');
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('hu-HU', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dateString;
            }
        }
        
        function showLoading(show) {
            const loadingElement = document.getElementById('loading');
            const formElement = document.getElementById('review-edit-form');
            
            if (show) {
                loadingElement.style.display = 'flex';
                if (formElement) formElement.style.display = 'none';
            } else {
                loadingElement.style.display = 'none';
                if (formElement) formElement.style.display = 'block';
            }
        }
        
        // Text form√°z√≥ f√ºggv√©nyek
        function formatText(command) {
            const textarea = document.getElementById('edit-content');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            let newText = '';
            let selectionLength = 0;
            
            switch(command) {
                case 'bold':
                    newText = `**${selectedText}**`;
                    selectionLength = 2;
                    break;
                case 'italic':
                    newText = `*${selectedText}*`;
                    selectionLength = 1;
                    break;
                case 'underline':
                    newText = `<u>${selectedText}</u>`;
                    selectionLength = 3;
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + 
                           newText + 
                           textarea.value.substring(end);
            
            textarea.focus();
            textarea.setSelectionRange(start + selectionLength, end + selectionLength);
        }
        
        function insertList() {
            const textarea = document.getElementById('edit-content');
            const start = textarea.selectionStart;
            const newText = '\n- ';
            
            textarea.value = textarea.value.substring(0, start) + 
                           newText + 
                           textarea.value.substring(start);
            
            textarea.focus();
            textarea.setSelectionRange(start + newText.length, start + newText.length);
        }
        
        function insertLink() {
            const url = prompt('Add meg a URL-t:', 'https://');
            if (!url) return;
            
            const text = prompt('Add meg a link sz√∂veg√©t:', 'link');
            if (text === null) return;
            
            const textarea = document.getElementById('edit-content');
            const start = textarea.selectionStart;
            const linkText = `[${text}](${url})`;
            
            textarea.value = textarea.value.substring(0, start) + 
                           linkText + 
                           textarea.value.substring(textarea.selectionEnd);
            
            textarea.focus();
            textarea.setSelectionRange(start + linkText.length, start + linkText.length);
        }

        function generateHTMLFromBlocks() {
    if (!window.editorBlocks || !Array.isArray(window.editorBlocks)) {
        return '';
    }
    
    let html = '';
    
    window.editorBlocks.forEach((block, index) => {
        const blockHtml = generateHTMLFromBlock(block);
        if (blockHtml) {
            html += blockHtml + '\n\n';
        }
    });
    
    return html.trim();
}

    </script>


// 2. K√©pfelt√∂lt≈ë modal √©s f√ºggv√©nyek - JAV√çTOTT VERZI√ì

<script>
// Glob√°lis v√°ltoz√≥ az aktu√°lis blokk indexhez
let currentImageBlockIndex = null;

// K√©pfelt√∂lt≈ë modal megnyit√°sa
function openImageUploader() {
    // Megkeress√ºk az aktu√°lis modal-t
    const editModal = document.querySelector('.edit-block-modal.active');
    if (editModal) {
        // Kiolvassuk a blokk index√©t a modal ID-b≈ël
        const modalId = editModal.id;
        const match = modalId.match(/edit-block-modal-(\d+)/);
        if (match) {
            currentImageBlockIndex = parseInt(match[1]);
        }
    }
    
    const modal = document.getElementById('image-upload-modal');
    modal.style.display = 'flex';
    
    // Reset √°llapot
    resetImageUploader();
    
    // Esem√©nykezel≈ëk
    setupImageUploadEvents();
    
    // ESC bez√°r√°s
    const handleEsc = (e) => {
        if (e.key === 'Escape') closeImageUploader();
    };
    document.addEventListener('keydown', handleEsc);
    
    // Modal bez√°r√°sa kattint√°sra
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeImageUploader();
        }
    });
}

// K√©pfelt√∂lt≈ë bez√°r√°sa
function closeImageUploader() {
    const modal = document.getElementById('image-upload-modal');
    modal.style.display = 'none';
    resetImageUploader();
    currentImageBlockIndex = null;
}

// K√©pfelt√∂lt≈ë reset
function resetImageUploader() {
    document.getElementById('image-url-input').value = '';
    document.getElementById('image-file-input').value = '';
    document.getElementById('upload-preview-container').style.display = 'none';
    document.getElementById('upload-progress').style.display = 'none';
    document.getElementById('upload-progress-bar').style.width = '0%';
    document.getElementById('upload-preview').innerHTML = '';
    document.getElementById('upload-file-name').textContent = '';
}

// K√©p haszn√°lata URL-b≈ël - JAV√çTVA
function useImageFromUrl() {
    const urlInput = document.getElementById('image-url-input');
    const imageUrl = urlInput.value.trim();
    
    if (!imageUrl) {
        showSuccessNotification('K√©rlek adj meg egy √©rv√©nyes URL-t!', 'error');
        return;
    }
    
    // Ellen≈ërizz√ºk, hogy k√©p URL-e (laz√°bb ellen≈ërz√©s)
    if (!imageUrl.match(/\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?.*)?$/i) && 
        !imageUrl.startsWith('data:image/') &&
        !imageUrl.startsWith('blob:')) {
        showSuccessNotification('Az URL nem l√°tszik k√©pf√°jlnak!', 'warning');
    }
    
    // K√©p haszn√°lata a szerkeszt≈ëben
    useImageInEditor(imageUrl);
    
    // Sikeres √ºzenet
    showSuccessNotification('K√©p URL beillesztve!', 'success');
    
    // Modal bez√°r√°sa
    setTimeout(() => {
        closeImageUploader();
    }, 500);
}

// K√©p haszn√°lata a szerkeszt≈ëben - JAV√çTVA
function useImageInEditor(imageUrl) {
    const editModal = document.querySelector('.edit-block-modal.active');
    if (!editModal) return;
    
    const urlInput = editModal.querySelector('[name="image-url"]');
    if (urlInput) {
        urlInput.value = imageUrl;
        
        // El≈ën√©zet friss√≠t√©se
        updateImagePreview();
        
        showSuccessNotification('K√©p URL beillesztve!', 'success');
    }
}

// K√©pfelt√∂lt√©s esem√©nykezel≈ëk
function setupImageUploadEvents() {
    const dropZone = document.getElementById('image-drop-zone');
    const fileInput = document.getElementById('image-file-input');
    
    // Drag and drop
    ['dragover', 'dragenter'].forEach(event => {
        dropZone.addEventListener(event, (e) => {
            e.preventDefault();
            dropZone.style.background = '#e8f4fd';
            dropZone.style.borderColor = '#1891d1';
        });
    });
    
    ['dragleave', 'dragend'].forEach(event => {
        dropZone.addEventListener(event, () => {
            dropZone.style.background = '#f8fafc';
            dropZone.style.borderColor = '#1891d1';
        });
    });
    
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.background = '#f8fafc';
        dropZone.style.borderColor = '#1891d1';
        
        if (e.dataTransfer.files.length > 0) {
            handleImageFile(e.dataTransfer.files[0]);
        }
    });
    
    // F√°jl kiv√°laszt√°s
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleImageFile(e.target.files[0]);
        }
    });
}

// K√©pf√°jl kezel√©se - JAV√çTVA
function handleImageFile(file) {
    // Ellen≈ërz√©s
    if (!file.type.startsWith('image/')) {
        showSuccessNotification('K√©rlek k√©pf√°jlt v√°lassz!', 'error');
        return;
    }
    
    if (file.size > 10 * 1024 * 1024) {
        showSuccessNotification('A k√©p t√∫l nagy! Maximum 10MB lehet.', 'error');
        return;
    }
    
    // El≈ën√©zet
    const reader = new FileReader();
    reader.onload = function(e) {
        const previewContainer = document.getElementById('upload-preview-container');
        const preview = document.getElementById('upload-preview');
        const fileName = document.getElementById('upload-file-name');
        
        preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 180px; border-radius: 4px; object-fit: contain;" alt="El≈ën√©zet">`;
        fileName.textContent = `${file.name} (${formatFileSize(file.size)})`;
        previewContainer.style.display = 'block';
        
        previewContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    };
    reader.readAsDataURL(file);
}

// K√©p felt√∂lt√©se a szerverre - TELJESEN √ÅT√çRVA (mivel nincs /api/upload/image endpoint)
async function uploadSelectedImage() {
    const fileInput = document.getElementById('image-file-input');
    if (!fileInput.files.length) {
        showSuccessNotification('Nincs k√©p kiv√°lasztva!', 'error');
        return;
    }
    
    const file = fileInput.files[0];
    
    // Felt√∂lt√©si √°llapot megjelen√≠t√©se
    const progressDiv = document.getElementById('upload-progress');
    const progressBar = document.getElementById('upload-progress-bar');
    progressDiv.style.display = 'block';
    progressBar.style.width = '30%';
    
    try {
        // Mivel nincs /api/upload/image endpoint, haszn√°ljuk a local storage-t vagy data URL-t
        showSuccessNotification('Nincs felt√∂lt√©si endpoint. A k√©p csak ideiglenesen ker√ºl ment√©sre.', 'warning');
        
        // V√°runk egy kicsit a progress effect miatt
        await new Promise(resolve => setTimeout(resolve, 1000));
        progressBar.style.width = '70%';
        
        // A f√°jlt data URL-k√©nt t√°roljuk (ideiglenes megold√°s)
        const reader = new FileReader();
        reader.onload = function(e) {
            progressBar.style.width = '100%';
            
            // Data URL haszn√°lata
            const dataUrl = e.target.result;
            
            setTimeout(() => {
                useImageInEditor(dataUrl);
                closeImageUploader();
                showSuccessNotification('K√©p bet√∂ltve (ideiglenes)!', 'success');
            }, 500);
        };
        reader.readAsDataURL(file);
        
    } catch (error) {
        console.error('Hiba a k√©p felt√∂lt√©se sor√°n:', error);
        progressBar.style.background = '#e74c3c';
        showSuccessNotification('Hiba t√∂rt√©nt! ' + error.message, 'error');
        
        setTimeout(() => {
            progressDiv.style.display = 'none';
            progressBar.style.width = '0%';
            progressBar.style.background = '#1891d1';
        }, 3000);
    }
}

// K√©p el≈ën√©zet friss√≠t√©se - JAV√çTVA
function updateImagePreview() {
    const urlInput = document.querySelector('.edit-block-modal.active [name="image-url"]');
    if (!urlInput) return;
    
    const imageUrl = urlInput.value.trim();
    const previewContainer = document.getElementById('image-preview-container');
    const preview = document.getElementById('image-preview');
    const urlDisplay = document.getElementById('image-url-display');
    const errorDiv = document.getElementById('image-error');
    
    if (errorDiv) errorDiv.style.display = 'none';
    
    if (imageUrl) {
        // Mindig mutassuk a kont√©nert, ha van URL
        previewContainer.style.display = 'block';
        urlDisplay.textContent = imageUrl;
        
        // T√∂lts√ºk be a k√©pet
        const img = new Image();
        img.onload = function() {
            preview.innerHTML = `<img src="${imageUrl}" style="max-width: 100%; max-height: 180px; border-radius: 4px; object-fit: contain;" alt="El≈ën√©zet">`;
        };
        img.onerror = function() {
            preview.innerHTML = `
                <div style="padding: 20px; color: #718096; text-align: center;">
                    <ion-icon name="image-outline" style="font-size: 48px; margin-bottom: 10px;"></ion-icon>
                    <p>K√©p bet√∂lt√©se sikertelen</p>
                    <small>URL: ${imageUrl.substring(0, 50)}${imageUrl.length > 50 ? '...' : ''}</small>
                </div>
            `;
        };
        
        // Cross-origin k√©pek kezel√©se
        img.crossOrigin = "anonymous";
        img.src = imageUrl;
        
        // Timeout, ha t√∫l lass√∫ a bet√∂lt√©s
        setTimeout(() => {
            if (!img.complete) {
                preview.innerHTML = `
                    <div style="padding: 20px; color: #f39c12; text-align: center;">
                        <ion-icon name="time-outline" style="font-size: 48px; margin-bottom: 10px;"></ion-icon>
                        <p>K√©p bet√∂lt√©se folyamatban...</p>
                    </div>
                `;
            }
        }, 1000);
        
    } else {
        previewContainer.style.display = 'none';
    }
}

// Seg√©df√ºggv√©nyek
function formatFileSize(bytes) {
    if (bytes === 0) return '0 B';
    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Az oldal bet√∂lt√©sekor inicializ√°ljuk az el≈ën√©zetet
document.addEventListener('DOMContentLoaded', function() {
    // Hozz√°adjuk az input esem√©nyt a k√©p URL mez≈ëh√∂z
    document.addEventListener('input', function(e) {
        if (e.target && e.target.name === 'image-url') {
            setTimeout(updateImagePreview, 100);
        }
    });
});
</script>

<!-- K√©pfelt√∂lt≈ë Modal HTML -->
<div id="image-upload-modal" class="image-upload-modal" style="display: none;">
    <div class="image-upload-modal-content">
        <div class="image-upload-modal-header">
            <h3>
                <ion-icon name="cloud-upload-outline"></ion-icon>
                K√©p felt√∂lt√©se / URL beilleszt√©s
            </h3>
            <button class="close-image-upload-modal" onclick="closeImageUploader()">√ó</button>
        </div>
        
        <div class="image-upload-modal-body">
            <!-- URL beilleszt√©s -->
            <div class="form-group">
                <label>K√©p URL beilleszt√©se</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="url" id="image-url-input" class="form-control" 
                           placeholder="https://example.com/image.jpg"
                           style="flex: 1;">
                    <button type="button" class="toolbar-btn" onclick="useImageFromUrl()" 
                            style="white-space: nowrap;">
                        <ion-icon name="link-outline"></ion-icon>
                        Haszn√°l
                    </button>
                </div>
                <small style="color: #6c757d; display: block; margin-top: 5px;">
                    B√°rmilyen k√©p URL-t beilleszthetsz (jpg, png, gif, webp, stb.)
                </small>
            </div>
            
            <div style="text-align: center; margin: 20px 0; position: relative;">
                <hr style="border: none; border-top: 1px solid #e2e8f0;">
                <div style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: white;
                    padding: 0 15px;
                    color: #718096;
                    font-weight: 500;
                ">VAGY</div>
            </div>
            
            <!-- F√°jlfelt√∂lt√©s (csak demo, mivel nincs endpoint) -->
            <div class="form-group">
                <label>K√©p felt√∂lt√©se sz√°m√≠t√≥g√©pr≈ël (demo)</label>
                <div id="image-drop-zone" style="
                    border: 2px dashed #1891d1;
                    border-radius: 8px;
                    padding: 40px 20px;
                    text-align: center;
                    background: #f8fafc;
                    cursor: pointer;
                    transition: all 0.3s;
                ">
                    <ion-icon name="images-outline" style="
                        font-size: 48px;
                        color: #1891d1;
                        margin-bottom: 15px;
                        display: block;
                    "></ion-icon>
                    <h4 style="margin: 0 0 10px 0; color: #2d3748;">
                        H√∫zd ide a k√©pet, vagy kattints a tall√≥z√°shoz
                    </h4>
                    <p style="color: #718096; margin: 0 0 20px 0;">
                        T√°mogatott form√°tumok: JPG, PNG, GIF, WebP (max 10MB)
                    </p>
                    <button type="button" class="toolbar-btn" onclick="document.getElementById('image-file-input').click()">
                        <ion-icon name="folder-open-outline"></ion-icon>
                        K√©p kiv√°laszt√°sa
                    </button>
                </div>
                <input type="file" id="image-file-input" accept="image/*" style="display: none;">
                <small style="color: #f39c12; display: block; margin-top: 5px;">
                    ‚ö†Ô∏è A felt√∂lt√©s jelenleg csak dem√≥ m√≥dban m≈±k√∂dik
                </small>
            </div>
            
            <!-- El≈ën√©zet -->
            <div id="upload-preview-container" style="
                margin-top: 20px;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 8px;
                border: 1px solid #e2e8f0;
                display: none;
            ">
                <h4 style="margin-top: 0; margin-bottom: 10px; color: #495057;">Kiv√°lasztott k√©p</h4>
                <div id="upload-preview" style="
                    max-width: 100%;
                    max-height: 200px;
                    overflow: hidden;
                    text-align: center;
                    margin-bottom: 15px;
                ">
                    <!-- Itt jelenik meg az el≈ën√©zet -->
                </div>
                <div style="display: flex; gap: 10px; justify-content: space-between; align-items: center;">
                    <span id="upload-file-name" style="
                        font-size: 12px;
                        color: #6c757d;
                        word-break: break-all;
                        flex: 1;
                    "></span>
                    <button type="button" class="toolbar-btn" onclick="uploadSelectedImage()" 
                            style="background: #20c997; color: white; border-color: #20c997;">
                        <ion-icon name="cloud-upload-outline"></ion-icon>
                        Bet√∂lt√©s (demo)
                    </button>
                </div>
            </div>
            
            <!-- Felt√∂lt√©si √°llapot -->
            <div id="upload-progress" style="display: none;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <ion-icon name="sync-outline" style="
                        font-size: 20px;
                        color: #1891d1;
                        animation: spin 1s linear infinite;
                    "></ion-icon>
                    <span style="color: #495057;">Felt√∂lt√©s folyamatban...</span>
                </div>
                <div style="
                    height: 6px;
                    background: #e2e8f0;
                    border-radius: 3px;
                    overflow: hidden;
                ">
                    <div id="upload-progress-bar" style="
                        height: 100%;
                        background: #1891d1;
                        width: 0%;
                        transition: width 0.3s;
                    "></div>
                </div>
            </div>
        </div>
        
        <div class="image-upload-modal-footer">
            <button type="button" class="btn-secondary" onclick="closeImageUploader()">
                <ion-icon name="close-outline"></ion-icon>
                Bez√°r√°s
            </button>
        </div>
    </div>
</div>

<style>
    .image-upload-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10001;
        animation: fadeIn 0.3s ease-out;
    }
    
    .image-upload-modal-content {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        animation: slideUp 0.3s ease-out;
    }
    
    .image-upload-modal-header {
        padding: 20px;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .image-upload-modal-header h3 {
        margin: 0;
        color: #2d3748;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .image-upload-modal-header .close-image-upload-modal {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #718096;
        line-height: 1;
    }
    
    .image-upload-modal-body {
        padding: 20px;
    }
    
    .image-upload-modal-footer {
        padding: 20px;
        border-top: 1px solid #e2e8f0;
        text-align: right;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Toolbar gomb st√≠lus */
    .toolbar-btn {
        padding: 8px 14px !important;
        background: white !important;
        border: 1px solid #dee2e6 !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        font-size: 14px !important;
        display: flex !important;
        align-items: center !important;
        gap: 6px !important;
        font-family: 'Poppins', sans-serif !important;
    }
    
    .toolbar-btn:hover {
        background: #1891d1 !important;
        color: white !important;
        border-color: #1891d1 !important;
    }
</style>


    <script>

        /**
 * Blokkok megjelen√≠t√©se a szerkeszt≈ëben
 */
/**
 * Blokkok megjelen√≠t√©se a szerkeszt≈ëben - JAV√çTVATOTT
 */
/**
 * Blokkok megjelen√≠t√©se a szerkeszt≈ëben - KIJAV√çTVA
 */
async function displayBlocksFromPost(blocksJson) {
    try {
        console.log('DisplayBlocksFromPost h√≠vva:', typeof blocksJson);
        
        const container = document.getElementById('edit-content');
        const blockEditor = document.getElementById('block-editor-container');
        
        if (!container || !blockEditor) {
            console.error('HIBA: Nincs container vagy blockEditor');
            return;
        }
        
        // Ha a blokkok JSON stringk√©nt √©rkeznek
        let blocks = blocksJson;
        if (typeof blocksJson === 'string') {
            console.log('Blocks JSON stringk√©nt √©rkezett, parse-olom...');
            try {
                blocks = JSON.parse(blocksJson);
                console.log('Blokkok parse-olva:', blocks);
            } catch (e) {
                console.error('Hiba a blokkok parse-ol√°sa sor√°n:', e);
                // Pr√≥b√°ljuk meg √∫jra egy m√°sik m√≥dszerrel
                try {
                    blocks = JSON.parse(blocksJson.replace(/\\/g, ''));
                } catch (e2) {
                    console.error('M√°sodik parse hiba:', e2);
                    return;
                }
            }
        }
        
        if (!Array.isArray(blocks)) {
            console.error('HIBA: A blocks nem t√∂mb:', blocks);
            return;
        }
        
        console.log(`${blocks.length} blokk bet√∂ltve`);
        
        // 1. HTML gener√°l√°sa blokkokb√≥l a textarea-hoz
        let htmlContent = '';
        blocks.forEach((block, index) => {
            const blockHtml = generateHTMLFromBlock(block);
            if (blockHtml) {
                htmlContent += blockHtml + '\n\n';
                console.log(`Blokk ${index} HTML:`, blockHtml.substring(0, 100) + '...');
            }
        });
        
        // Be√°ll√≠tjuk a tartalmat
        container.value = htmlContent.trim();
        console.log('Textarea tartalom be√°ll√≠tva, hossz:', container.value.length);
        
        // 2. Blokk szerkeszt≈ë kont√©ner felt√∂lt√©se
        loadBlocksForEditing(blocks);
        
    } catch (error) {
        console.error('Hiba a blokkok megjelen√≠t√©se sor√°n:', error);
        console.error('Stack trace:', error.stack);
    }
}
/**
 * HTML gener√°l√°sa egyetlen blokkb√≥l
 */
/**
 * HTML gener√°l√°sa egyetlen blokkb√≥l - KIJAV√çTVA
 */
function generateHTMLFromBlock(block) {
    if (!block || !block.type) {
        console.warn('HIBA: √ârv√©nytelen blokk:', block);
        return '';
    }
    
    console.log(`Generating HTML for block type: ${block.type}`, block);
    
    let html = '';
    
    try {
        switch(block.type) {
            case 'paragraph':
                html = `<p class="block-paragraph">${escapeHtml(block.content || '')}</p>`;
                break;
                
            case 'heading':
                const level = block.attributes?.level || 'h2';
                html = `<${level} class="block-heading">${escapeHtml(block.content || '')}</${level}>`;
                break;
                
            case 'image':
                const alt = block.attributes?.alt || '';
                const caption = block.attributes?.caption || '';
                html = `<figure class="block-image">`;
                html += `<img src="${escapeHtml(block.content || '')}" alt="${escapeHtml(alt)}">`;
                if (caption) {
                    html += `<figcaption>${escapeHtml(caption)}</figcaption>`;
                }
                html += `</figure>`;
                break;
                
            case 'quote':
                const author = block.attributes?.author ? 
                    `<cite>‚Äî ${escapeHtml(block.attributes.author)}</cite>` : '';
                html = `<blockquote class="block-quote">`;
                html += `<p>${escapeHtml(block.content || '').replace(/\n/g, '<br>')}</p>`;
                html += author;
                html += `</blockquote>`;
                break;
                
            case 'list':
                const listType = block.attributes?.type || 'ul';
                html = `<${listType} class="block-list">\n`;
                const items = Array.isArray(block.content) ? block.content : [block.content];
                items.forEach(item => {
                    if (item && item.trim() !== '') {
                        html += `  <li>${escapeHtml(item)}</li>\n`;
                    }
                });
                html += `</${listType}>`;
                break;
                
            case 'code':
                const language = block.attributes?.language ? 
                    ` class="language-${escapeHtml(block.attributes.language)}"` : '';
                html = `<pre class="block-code"><code${language}>${escapeHtml(block.content || '')}</code></pre>`;
                break;
                
            case 'divider':
                html = `<hr class="block-divider">`;
                break;
                
            case 'embed':
                html = `<div class="block-embed" data-url="${escapeHtml(block.content || '')}">
                    [Be√°gyazott tartalom: ${escapeHtml(block.content || '')}]
                </div>`;
                break;
                
            default:
                console.warn(`Ismeretlen blokk t√≠pus: ${block.type}`);
                html = `<div class="block-${block.type}">${escapeHtml(block.content || '')}</div>`;
        }
        
        console.log(`Generated HTML for ${block.type}:`, html.substring(0, 100) + (html.length > 100 ? '...' : ''));
        
    } catch (error) {
        console.error('Hiba a HTML gener√°l√°sa sor√°n:', error);
        html = `<p>Hiba a blokk gener√°l√°sa sor√°n: ${escapeHtml(error.message)}</p>`;
    }
    
    return html;
}
/**
 * HTML escape f√ºggv√©ny
 */
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

/**
 * Blokk n√©zet v√°lt√°sa
 */
/**
 * Blokk n√©zet v√°lt√°sa - FRISS√çTVE
 */
function toggleBlockView() {
    const blockEditor = document.getElementById('block-editor-container');
    const textEditor = document.getElementById('edit-content');
    const toggleBtn = document.getElementById('block-view-toggle');
    
    if (blockEditor.style.display === 'none') {
        // Blokk n√©zetre v√°lt√°s
        blockEditor.style.display = 'block';
        textEditor.style.display = 'none';
        toggleBtn.innerHTML = '<ion-icon name="document-text-outline"></ion-icon> Sz√∂veges n√©zet';
        
        // Blokkok bet√∂lt√©se, ha m√©g nem t√∂rt√©nt meg
        if (!window.editorBlocks && originalPost && originalPost.blocks_json) {
            try {
                const blocks = JSON.parse(originalPost.blocks_json);
                loadBlocksForEditing(blocks);
            } catch (error) {
                console.error('Hiba a blokkok bet√∂lt√©se sor√°n:', error);
            }
        }
    } else {
        // Sz√∂veges n√©zetre v√°lt√°s
        blockEditor.style.display = 'none';
        textEditor.style.display = 'block';
        toggleBtn.innerHTML = '<ion-icon name="grid-outline"></ion-icon> Blokkos n√©zet';
    }
}

/**
 * Blokkok bet√∂lt√©se szerkeszt√©shez
 */
/**
 * Blokkok bet√∂lt√©se szerkeszt√©shez - JAV√çTVATOTT
 */
async function loadBlocksForEditing(blocks) {
    const container = document.getElementById('block-editor-container');
    const noBlocksMsg = document.getElementById('no-blocks-message');
    
    if (!blocks || !Array.isArray(blocks) || blocks.length === 0) {
        if (noBlocksMsg) noBlocksMsg.style.display = 'block';
        return;
    }
    
    if (noBlocksMsg) noBlocksMsg.style.display = 'none';
    
    // Elmentj√ºk a blokkokat glob√°lis v√°ltoz√≥ba
    window.editorBlocks = [...blocks];
    console.log('Editor blocks inicializ√°lva:', window.editorBlocks.length, 'blokk');
    
    // T√∂lts√ºk be az √∂sszes felhaszn√°l√≥t a szerz≈ëk megjelen√≠t√©s√©hez
    await loadAllUsers();
    
    container.innerHTML = '';
    
    // Blokk t√≠pusokhoz tartoz√≥ ikonok
    const blockIcons = {
        'paragraph': 'document-text-outline',
        'heading': 'text-outline',
        'image': 'image-outline',
        'quote': 'quote-outline',
        'list': 'list-outline',
        'code': 'code-slash-outline',
        'divider': 'remove-outline',
        'embed': 'link-outline'
    };
    
    // Sz√≠nek blokk t√≠pusonk√©nt
    const blockColors = {
        'heading': '#1891d1',
        'paragraph': '#4a6cf7',
        'image': '#20c997',
        'quote': '#6f42c1',
        'list': '#fd7e14',
        'code': '#343a40',
        'divider': '#6c757d',
        'embed': '#17a2b8'
    };
    
    // Minden blokk megjelen√≠t√©se
    blocks.forEach((block, index) => {
        const blockDiv = document.createElement('div');
        blockDiv.className = 'review-block draggable-block'; // Hozz√°adtam: draggable-block
        blockDiv.draggable = true;
        blockDiv.dataset.blockIndex = index;
        blockDiv.dataset.blockType = block.type;
        blockDiv.style.cssText = `
            margin-bottom: 15px;
            padding: 15px;
            border: 2px solid ${blockColors[block.type] || '#e2e8f0'};
            border-radius: 8px;
            background: white;
            position: relative;
            transition: all 0.3s ease;
        `;
        
        // Blokk fejl√©c
        const headerDiv = document.createElement('div');
        headerDiv.style.cssText = `
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f1f1f1;
        `;
        
        // Bal oldal: blokk t√≠pus √©s poz√≠ci√≥
        const leftInfo = document.createElement('div');
        leftInfo.style.cssText = `
            display: flex;
            align-items: center;
            gap: 10px;
        `;
        
        // Poz√≠ci√≥ badge
        const posBadge = document.createElement('div');
        posBadge.style.cssText = `
            background: #6c757d;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        `;
        posBadge.textContent = `#${index + 1}`;
        
        // T√≠pus badge
        const typeBadge = document.createElement('div');
        typeBadge.style.cssText = `
            background: ${blockColors[block.type] || '#4a6cf7'};
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        `;
        typeBadge.innerHTML = `
            <ion-icon name="${blockIcons[block.type] || 'cube-outline'}" style="font-size: 14px;"></ion-icon>
            ${getBlockTypeName(block.type)}
        `;
        
        // Jobb oldal: m≈±veletek
        const rightActions = document.createElement('div');
        rightActions.style.cssText = `
            display: flex;
            gap: 5px;
        `;
        
        // M≈±velet gombok
        const actionButtons = [
            { icon: 'create-outline', title: 'Szerkeszt√©s', action: 'edit' },
            { icon: 'copy-outline', title: 'Duplik√°l√°s', action: 'duplicate' },
            { icon: 'trash-outline', title: 'T√∂rl√©s', action: 'delete', color: '#e74c3c' }
        ];
        
        actionButtons.forEach(btn => {
            const btnEl = document.createElement('button');
            btnEl.type = 'button';
            btnEl.title = btn.title;
            btnEl.style.cssText = `
                background: ${btn.color || '#f8f9fa'};
                border: 1px solid #dee2e6;
                border-radius: 6px;
                padding: 6px 10px;
                cursor: pointer;
                color: ${btn.color ? 'white' : '#495057'};
                display: flex;
                align-items: center;
                gap: 4px;
                font-size: 12px;
                transition: all 0.2s;
            `;
            btnEl.innerHTML = `<ion-icon name="${btn.icon}" style="font-size: 14px;"></ion-icon>`;
            
            btnEl.onmouseenter = () => {
                btnEl.style.background = btn.color || '#e9ecef';
            };
            btnEl.onmouseleave = () => {
                btnEl.style.background = btn.color || '#f8f9fa';
            };
            
            btnEl.onclick = () => handleBlockAction(btn.action, index, block);
            rightActions.appendChild(btnEl);
        });
        
        leftInfo.appendChild(posBadge);
        leftInfo.appendChild(typeBadge);
        headerDiv.appendChild(leftInfo);
        headerDiv.appendChild(rightActions);
        
        // Blokk tartalom
        const contentDiv = document.createElement('div');
        contentDiv.style.cssText = `
            margin-top: 10px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-height: 50px;
            border-left: 3px solid ${blockColors[block.type] || '#4a6cf7'};
        `;
        
        let contentText = '';
        
        switch(block.type) {
            case 'heading':
                const level = block.attributes?.level || 'h2';
                contentText = `üìù ${level.toUpperCase()}: ${block.content || ''}`;
                break;
                
            case 'paragraph':
                contentText = `üìÑ ${block.content || ''}`;
                break;
                
            case 'image':
                contentText = `üñºÔ∏è K√©p: ${block.content || ''}\n`;
                if (block.attributes?.alt) {
                    contentText += `Alt: ${block.attributes.alt}\n`;
                }
                if (block.attributes?.caption) {
                    contentText += `Al√°√≠r√°s: ${block.attributes.caption}`;
                }
                break;
                
            case 'quote':
                contentText = `üí¨ Id√©zet: ${block.content || ''}\n`;
                if (block.attributes?.author) {
                    contentText += `‚Äî ${block.attributes.author}`;
                }
                break;
                
            case 'list':
                contentText = `üìã Lista (${block.attributes?.type || 'ul'}):\n`;
                const items = Array.isArray(block.content) ? block.content : [block.content];
                items.forEach((item, i) => {
                    contentText += `  ${i + 1}. ${item || ''}\n`;
                });
                break;
                
            case 'code':
                const lang = block.attributes?.language || 'nincs megadva';
                contentText = `üíª K√≥d (${lang}):\n${block.content || ''}`;
                break;
                
            case 'divider':
                contentText = `‚ûñ Elv√°laszt√≥ sor`;
                break;
                
            case 'embed':
                contentText = `üîó Be√°gyaz√°s: ${block.content || ''}`;
                if (block.attributes?.type) {
                    contentText += `\nT√≠pus: ${block.attributes.type}`;
                }
                break;
                
            default:
                contentText = `‚ùì Ismeretlen blokk: ${JSON.stringify(block, null, 2)}`;
        }
        
        contentDiv.textContent = contentText;
        
        // Attrib√∫tumok megjelen√≠t√©se (ha vannak)
        if (block.attributes && Object.keys(block.attributes).length > 0) {
            const attrsDiv = document.createElement('div');
            attrsDiv.style.cssText = `
                margin-top: 10px;
                padding: 8px;
                background: #e8f4fd;
                border-radius: 4px;
                font-size: 12px;
                color: #1891d1;
            `;
            
            let attrsText = '‚öôÔ∏è Attrib√∫tumok: ';
            Object.entries(block.attributes).forEach(([key, value]) => {
                if (value && value !== '') {
                    attrsText += `${key}: ${value}; `;
                }
            });
            
            attrsDiv.textContent = attrsText.trim();
            contentDiv.appendChild(attrsDiv);
        }
        
        // St√≠lusok megjelen√≠t√©se (ha vannak)
        if (block.styles && Object.keys(block.styles).length > 0) {
            const stylesDiv = document.createElement('div');
            stylesDiv.style.cssText = `
                margin-top: 10px;
                padding: 8px;
                background: #f8f9fa;
                border-radius: 4px;
                font-size: 11px;
                color: #6c757d;
                font-family: 'Courier New', monospace;
            `;
            
            let stylesText = 'üé® St√≠lusok:\n';
            Object.entries(block.styles).forEach(([key, value]) => {
                if (value && value !== '') {
                    stylesText += `  ${key}: ${value}\n`;
                }
            });
            
            stylesDiv.textContent = stylesText.trim();
            contentDiv.appendChild(stylesDiv);
        }
        
        blockDiv.appendChild(headerDiv);
        blockDiv.appendChild(contentDiv);
        container.appendChild(blockDiv);
    });

        setupDragAndDrop();
//        addSaveBlocksButton();
    
    console.log(`${blocks.length} blokk bet√∂ltve a szerkeszt≈ëbe`);
}


/**
 * Blokkok ment√©se textarea-ba
 */
function saveBlocksToTextarea() {
    // Jelenleg csak vissza√°ll√≠tjuk az eredeti tartalmat
    const textarea = document.getElementById('edit-content');
    // Ha m√≥dos√≠tottuk a blokkokat, itt kellene √∂sszegy≈±jteni
}

/**
 * Blokk t√≠pusn√©v lek√©rdez√©se
 */
function getBlockTypeName(type) {
    const names = {
        'paragraph': 'Bekezd√©s',
        'heading': 'C√≠msor',
        'image': 'K√©p',
        'quote': 'Id√©zet',
        'list': 'Lista',
        'code': 'K√≥d',
        'divider': 'Elv√°laszt√≥',
        'embed': 'Be√°gyaz√°s'
    };
    
    return names[type] || 'Ismeretlen';
}


/**
 * Drag & Drop be√°ll√≠t√°sa
 */
/**
 * Drag & Drop be√°ll√≠t√°sa - JAV√çTVATOTT
 */
function setupDragAndDrop() {
    const container = document.getElementById('block-editor-container');
    if (!container) {
        console.error('Drag & drop kont√©ner nem tal√°lhat√≥');
        return;
    }
    
    let draggedBlock = null;
    let draggedIndex = null;
    
    // Drag start
    container.addEventListener('dragstart', (e) => {
        const block = e.target.closest('.draggable-block');
        if (block) {
            draggedBlock = block;
            draggedIndex = parseInt(block.dataset.blockIndex);
            
            block.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', draggedIndex);
            
            console.log(`Drag start: block ${draggedIndex}`);
        }
    });
    
    // Drag over
    container.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        
        const blocks = Array.from(container.querySelectorAll('.draggable-block:not(.dragging)'));
        const afterElement = getDragAfterElement(container, e.clientY);
        
        if (afterElement) {
            afterElement.classList.add('drag-over');
        }
    });
    
    // Drag leave
    container.addEventListener('dragleave', (e) => {
        const block = e.target.closest('.draggable-block');
        if (block && block !== draggedBlock) {
            block.classList.remove('drag-over');
        }
    });
    
    // Drop
    container.addEventListener('drop', (e) => {
        e.preventDefault();
        
        const afterElement = getDragAfterElement(container, e.clientY);
        const blocks = Array.from(container.querySelectorAll('.draggable-block'));
        
        // Drag-over class elt√°vol√≠t√°sa
        blocks.forEach(block => block.classList.remove('drag-over'));
        
        if (draggedBlock) {
            let insertIndex = 0;
            
            if (afterElement) {
                insertIndex = parseInt(afterElement.dataset.blockIndex);
                if (insertIndex > draggedIndex) {
                    insertIndex--;
                }
                container.insertBefore(draggedBlock, afterElement);
            } else {
                insertIndex = blocks.length - 1;
                container.appendChild(draggedBlock);
            }
            
            // Blokk poz√≠ci√≥ friss√≠t√©se
            draggedBlock.classList.remove('dragging');
            
            // Blokkok t√∂mbj√©nek √∫jrarendez√©se
            if (draggedIndex !== insertIndex) {
                const movedBlock = window.editorBlocks[draggedIndex];
                window.editorBlocks.splice(draggedIndex, 1);
                window.editorBlocks.splice(insertIndex, 0, movedBlock);
                
                // Poz√≠ci√≥k friss√≠t√©se
                updateBlockPositions();
                updateTextareaFromBlocks();
                
                console.log(`Block moved from ${draggedIndex} to ${insertIndex}`);
                showSuccessNotification('Blokk poz√≠ci√≥ja friss√≠tve!');
            }
        }
        
        draggedBlock = null;
        draggedIndex = null;
    });
    
    // Drag end
    container.addEventListener('dragend', (e) => {
        if (draggedBlock) {
            draggedBlock.classList.remove('dragging');
            const blocks = container.querySelectorAll('.draggable-block');
            blocks.forEach(block => block.classList.remove('drag-over'));
        }
        draggedBlock = null;
        draggedIndex = null;
    });
}
/**
 * Blokk drag esem√©nyeinek be√°ll√≠t√°sa
 */
function setupBlockDragEvents(blockDiv, index) {
    blockDiv.addEventListener('dragstart', (e) => {
        e.stopPropagation();
    });
    
    blockDiv.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.stopPropagation();
    });
    
    blockDiv.addEventListener('dragenter', (e) => {
        e.preventDefault();
        if (!blockDiv.classList.contains('dragging')) {
            blockDiv.classList.add('drag-over');
            blockDiv.style.boxShadow = '0 0 0 2px #1891d1';
        }
    });
    
    blockDiv.addEventListener('dragleave', (e) => {
        if (!blockDiv.contains(e.relatedTarget)) {
            blockDiv.classList.remove('drag-over');
            blockDiv.style.boxShadow = '';
        }
    });
    
    blockDiv.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        blockDiv.classList.remove('drag-over');
        blockDiv.style.boxShadow = '';
    });
}

/**
 * Drag ut√°n elem keres√©se
 */
function getDragAfterElement(container, y) {
    const draggableElements = [...container.querySelectorAll('.draggable-block:not(.dragging)')];
    
    return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        
        if (offset < 0 && offset > closest.offset) {
            return { offset: offset, element: child };
        } else {
            return closest;
        }
    }, { offset: Number.NEGATIVE_INFINITY }).element;
}

/**
 * Blokk poz√≠ci√≥k friss√≠t√©se
 */
function updateBlockPositions() {
    const container = document.getElementById('block-editor-container');
    const blocks = Array.from(container.querySelectorAll('.draggable-block'));
    
    blocks.forEach((block, index) => {
        const posBadge = block.querySelector('.position-badge');
        if (posBadge) {
            posBadge.textContent = `#${index + 1}`;
        }
        block.dataset.blockIndex = index;
    });
    
    console.log(`Positions updated: ${blocks.length} blocks`);
}

/**
 * Blokkok t√∂mbj√©nek √∫jrarendez√©se
 */
function reorderBlocksArray() {
    const container = document.getElementById('block-editor-container');
    const blocks = Array.from(container.querySelectorAll('.draggable-block'));
    
    const newBlocks = blocks.map(block => {
        const index = parseInt(block.dataset.blockIndex);
        return window.editorBlocks[index];
    });
    
    window.editorBlocks = newBlocks;
    console.log('Blocks array reordered:', window.editorBlocks.length, 'blocks');
}

/**
 * Diff n√©zet friss√≠t√©se
 */
function updateDiffView() {
    if (originalPost && originalPost.blocks_json) {
        try {
            const originalBlocks = JSON.parse(originalPost.blocks_json);
            const editedContent = document.getElementById('edit-content').value;
            
            // Itt lehetne √∂sszehasonl√≠tani a blokkokat
            // Jelenleg egyszer≈± sz√∂veges diff-et jelen√≠t√ºnk meg
            showDiff(originalPost, {
                title: document.getElementById('edit-title').value,
                category: document.getElementById('edit-category').value,
                minimal_desc: document.getElementById('edit-excerpt').value,
                desc: editedContent
            });
            
        } catch (error) {
            console.error('Hiba a diff gener√°l√°sa sor√°n:', error);
        }
    }
}

/**
 * Blokk m≈±veletek kezel√©se
 */
/**
 * Blokk m≈±veletek kezel√©se
 */
async function handleBlockAction(action, index, block) {
    console.log(`Block action: ${action} at index ${index}`, block);
    
    if (!window.editorBlocks || !window.editorBlocks[index]) {
        console.error('Nincs editorBlocks vagy √©rv√©nytelen index');
        return;
    }
    
    switch(action) {
        case 'edit':
            await editBlock(index, block); // Ez most m√°r a t√©nyleges szerkeszt≈ët h√≠vja
            break;
        case 'duplicate':
            await duplicateBlock(index, block);
            break;
        case 'delete':
            await deleteBlock(index, block);
            break;
    }
}

/**
 * Blokk duplik√°l√°sa - JAV√çTVATOTT
 */
async function duplicateBlock(index, block) {
    const result = await showConfirmModal({
        title: 'Blokk duplik√°l√°sa',
        message: `Biztosan duplik√°lni szeretn√©d ezt a blokkot?`,
        subMessage: `A duplik√°lt blokk az eredeti al√° ker√ºl.`,
        icon: 'copy-outline',
        confirmText: 'Igen, duplik√°lom',
        cancelText: 'M√©gse',
        details: [
            { label: 'Poz√≠ci√≥', value: index + 1 },
            { label: 'T√≠pus', value: getBlockTypeName(block.type) }
        ]
    });
    
    if (result) {
        // Blokk m√°solata l√©trehoz√°sa
        const duplicatedBlock = JSON.parse(JSON.stringify(block));
        duplicatedBlock.id = `block_${Date.now()}_duplicate_${index}`;
        
        // Besz√∫r√°s az index+1 helyre
        window.editorBlocks.splice(index + 1, 0, duplicatedBlock);
        
        // Friss√≠tj√ºk a megjelen√≠t√©st
        refreshBlockDisplay();
        
        showSuccessNotification('Blokk sikeresen duplik√°lva!');
    }
}


async function editBlock(index, block) {
    const config = getBlockConfig();
    const modalHTML = createEditModalHTML(block, index, config);
    
    const modalContainer = document.createElement('div');
    modalContainer.innerHTML = modalHTML;
    document.body.appendChild(modalContainer);
    
    const modal = modalContainer.querySelector('.edit-block-modal');
    const form = modal.querySelector('.edit-block-form');
    const saveBtn = modal.querySelector('.save-block-btn');
    const cancelBtn = modal.querySelector('.cancel-block-btn');
    
    // Mez≈ëk kit√∂lt√©se
    if (form) {
        const titleInput = form.querySelector('[name="block-title"]');
        const contentTextarea = form.querySelector('[name="block-content"]');
        
        if (block.type === 'heading' && titleInput) {
            titleInput.value = block.content || '';
        }
        
        if (contentTextarea) {
            if (block.type === 'list' && Array.isArray(block.content)) {
                contentTextarea.value = block.content.join('\n');
            } else {
                contentTextarea.value = block.content || '';
            }
        }
        
        // K√©p URL
        if (block.type === 'image') {
            const urlInput = form.querySelector('[name="image-url"]');
            const altInput = form.querySelector('[name="image-alt"]');
            const captionInput = form.querySelector('[name="image-caption"]');
            
            if (urlInput) urlInput.value = block.content || '';
            if (altInput) altInput.value = block.attributes?.alt || '';
            if (captionInput) captionInput.value = block.attributes?.caption || '';
        }
        
        // Id√©zet szerz≈ë
        if (block.type === 'quote') {
            const authorInput = form.querySelector('[name="quote-author"]');
            if (authorInput) authorInput.value = block.attributes?.author || '';
        }
        
        // K√≥d nyelv
        if (block.type === 'code') {
            const languageInput = form.querySelector('[name="code-language"]');
            if (languageInput) languageInput.value = block.attributes?.language || '';
        }
        
        // Embed URL
        if (block.type === 'embed') {
            const embedUrlInput = form.querySelector('[name="embed-url"]');
            if (embedUrlInput) embedUrlInput.value = block.content || '';
        }
    }
    
    // Ment√©s
    if (saveBtn) {
        saveBtn.addEventListener('click', async () => {
            const updatedBlock = await getUpdatedBlockData(form, block, index);
            if (updatedBlock) {
                updateBlockInArray(index, updatedBlock);
                refreshBlockDisplay();
                modal.remove();
                showSuccessNotification('Blokk sikeresen friss√≠tve!');
            }
        });
    }
    
    // M√©gse
    if (cancelBtn) {
        cancelBtn.addEventListener('click', () => {
            modal.remove();
        });
    }
    
    // ESC vagy kattint√°s k√≠v√ºlre
    const handleEsc = (e) => {
        if (e.key === 'Escape') modal.remove();
    };
    document.addEventListener('keydown', handleEsc);
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
    });
    
    modal.classList.add('active');
}

function updateBlockInArray(index, updatedBlock) {
    if (window.editorBlocks && window.editorBlocks[index]) {
        window.editorBlocks[index] = updatedBlock;
    }
}


function createEditModalHTML(block, index, config) {
    const title = getBlockTypeName(block.type);
    const color = config.colors[block.type] || '#4a6cf7';
    
    let modalContent = '';
    
    switch(block.type) {
        case 'heading':
            modalContent = `
                <div class="form-group">
                    <label>C√≠m</label>
                    <input type="text" name="block-title" class="form-control" 
                           placeholder="√çrd be a c√≠met...">
                </div>
                <div class="form-group">
                    <label>C√≠mszint</label>
                    <select name="heading-level" class="form-control">
                        <option value="h1" ${block.attributes?.level === 'h1' ? 'selected' : ''}>H1 - F≈ëc√≠m</option>
                        <option value="h2" ${(!block.attributes?.level || block.attributes.level === 'h2') ? 'selected' : ''}>H2 - Alc√≠m</option>
                        <option value="h3" ${block.attributes?.level === 'h3' ? 'selected' : ''}>H3 - Harmadik szint</option>
                        <option value="h4" ${block.attributes?.level === 'h4' ? 'selected' : ''}>H4 - Negyedik szint</option>
                    </select>
                </div>
            `;
            break;
            
        case 'paragraph':
            modalContent = `
                <div class="form-group">
                    <label>Sz√∂veg</label>
                    <textarea name="block-content" class="form-control" rows="6" 
                              placeholder="√çrd be a sz√∂veget..."></textarea>
                </div>
            `;
            break;
            
        // K√©pblokk szerkeszt≈ë r√©sze - az editBlock f√ºggv√©nyben a 'image' case

// 1. El≈ësz√∂r a K√âPBL√ñKK SZERKESZT≈ê r√©sz jav√≠t√°sa (editBlock f√ºggv√©nyben)
case 'image':
    modalContent = `
        <div class="form-group">
            <label>K√©p URL</label>
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <input type="url" id="edit-image-url" name="image-url" class="form-control" 
                       placeholder="https://example.com/image.jpg"
                       value="${block.content || ''}"
                       oninput="updateImagePreview()">
                <button type="button" class="toolbar-btn" onclick="openImageUploader()" 
                        style="white-space: nowrap;">
                    <ion-icon name="cloud-upload-outline"></ion-icon>
                    Felt√∂lt√©s
                </button>
            </div>
        </div>
        <div class="form-group">
            <label>Alternat√≠v sz√∂veg (alt)</label>
            <input type="text" id="edit-image-alt" name="image-alt" class="form-control" 
                   placeholder="A k√©p le√≠r√°sa..."
                   value="${block.attributes?.alt || ''}">
        </div>
        <div class="form-group">
            <label>Al√°√≠r√°s (caption)</label>
            <input type="text" id="edit-image-caption" name="image-caption" class="form-control" 
                   placeholder="K√©pal√°√≠r√°s..."
                   value="${block.attributes?.caption || ''}">
        </div>
        
        <!-- K√©p el≈ën√©zet -->
        <div id="image-preview-container" style="
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #dee2e6;
            ${block.content ? 'display: block;' : 'display: none;'}
        ">
            <h4 style="margin-top: 0; margin-bottom: 10px; color: #495057;">K√©p el≈ën√©zet</h4>
            <div id="image-preview" style="
                max-width: 100%;
                max-height: 200px;
                overflow: hidden;
                text-align: center;
            ">
                ${block.content ? `<img src="${escapeHtml(block.content)}" style="max-width: 100%; max-height: 180px; border-radius: 4px;" alt="El≈ën√©zet" onerror="this.style.display='none'; document.getElementById('image-error').style.display='block';">` : 'Nincs k√©p kiv√°lasztva'}
                <div id="image-error" style="display: none; color: #e74c3c; padding: 10px;">
                    <ion-icon name="warning-outline"></ion-icon>
                    A k√©p nem t√∂lthet≈ë be
                </div>
            </div>
        </div>
    `;
    break;            
        case 'quote':
            modalContent = `
                <div class="form-group">
                    <label>Id√©zet sz√∂vege</label>
                    <textarea name="block-content" class="form-control" rows="4" 
                              placeholder="√çrd be az id√©zetet..."></textarea>
                </div>
                <div class="form-group">
                    <label>Szerz≈ë</label>
                    <input type="text" name="quote-author" class="form-control" 
                           placeholder="A szerz≈ë neve...">
                </div>
            `;
            break;
            
        case 'list':
            modalContent = `
                <div class="form-group">
                    <label>Listaelemek (soronk√©nt egy)</label>
                    <textarea name="block-content" class="form-control" rows="6" 
                              placeholder="Els≈ë elem&#10;M√°sodik elem&#10;Harmadik elem"></textarea>
                </div>
                <div class="form-group">
                    <label>Lista t√≠pusa</label>
                    <select name="list-type" class="form-control">
                        <option value="ul" ${(!block.attributes?.type || block.attributes.type === 'ul') ? 'selected' : ''}>Felsorol√°s (pontozott)</option>
                        <option value="ol" ${block.attributes?.type === 'ol' ? 'selected' : ''}>Sz√°mozott</option>
                    </select>
                </div>
            `;
            break;
            
        case 'code':
            modalContent = `
                <div class="form-group">
                    <label>K√≥d</label>
                    <textarea name="block-content" class="form-control" rows="8" 
                              placeholder="√çrd be a k√≥dot..."></textarea>
                </div>
                <div class="form-group">
                    <label>Programoz√°si nyelv</label>
                    <input type="text" name="code-language" class="form-control" 
                           placeholder="pl.: javascript, python, php...">
                </div>
            `;
            break;
            
        case 'embed':
            modalContent = `
                <div class="form-group">
                    <label>Be√°gyazott tartalom URL</label>
                    <input type="url" name="embed-url" class="form-control" 
                           placeholder="https://www.youtube.com/watch?v=...">
                </div>
                <div class="form-group">
                    <label>T√≠pus (automatikus)</label>
                    <input type="text" class="form-control" disabled 
                           value="${block.attributes?.type || 'Auto-detected'}">
                </div>
            `;
            break;
            
        default:
            modalContent = `
                <div class="form-group">
                    <label>Tartalom</label>
                    <textarea name="block-content" class="form-control" rows="6" 
                              placeholder="√çrd be a tartalmat...">${JSON.stringify(block, null, 2)}</textarea>
                </div>
            `;
    }
    
    return `
        <div class="edit-block-modal" id="edit-block-modal-${index}">
            <div class="edit-block-modal-content">
                <div class="edit-block-modal-header" style="border-left-color: ${color}">
                    <ion-icon name="${config.icons[block.type] || 'cube-outline'}"></ion-icon>
                    <h3>${title} szerkeszt√©se</h3>
                    <button class="close-edit-modal">√ó</button>
                </div>
                
                <form class="edit-block-form">
                    ${modalContent}
                </form>
                
                <div class="edit-block-modal-footer">
                    <button type="button" class="btn-secondary cancel-block-btn">
                        <ion-icon name="close-outline"></ion-icon>
                        M√©gse
                    </button>
                    <button type="button" class="btn-primary save-block-btn">
                        <ion-icon name="save-outline"></ion-icon>
                        Ment√©s
                    </button>
                </div>
            </div>
        </div>
    `;
}




/**
 * Blokk duplik√°l√°sa
 */
async function getUpdatedBlockData(form, originalBlock, index) {
    if (!form) return null;
    
    const updatedBlock = JSON.parse(JSON.stringify(originalBlock));
    
    switch(originalBlock.type) {
        case 'heading':
            const title = form.querySelector('[name="block-title"]')?.value || '';
            const level = form.querySelector('[name="heading-level"]')?.value || 'h2';
            updatedBlock.content = title;
            updatedBlock.attributes.level = level;
            break;
            
        case 'paragraph':
            updatedBlock.content = form.querySelector('[name="block-content"]')?.value || '';
            break;
            
        case 'image':
            updatedBlock.content = form.querySelector('[name="image-url"]')?.value || '';
            updatedBlock.attributes.alt = form.querySelector('[name="image-alt"]')?.value || '';
            updatedBlock.attributes.caption = form.querySelector('[name="image-caption"]')?.value || '';
            break;
            
        case 'quote':
            updatedBlock.content = form.querySelector('[name="block-content"]')?.value || '';
            updatedBlock.attributes.author = form.querySelector('[name="quote-author"]')?.value || '';
            break;
            
        case 'list':
            const listContent = form.querySelector('[name="block-content"]')?.value || '';
            const listType = form.querySelector('[name="list-type"]')?.value || 'ul';
            updatedBlock.content = listContent.split('\n').filter(item => item.trim() !== '');
            updatedBlock.attributes.type = listType;
            break;
            
        case 'code':
            updatedBlock.content = form.querySelector('[name="block-content"]')?.value || '';
            updatedBlock.attributes.language = form.querySelector('[name="code-language"]')?.value || '';
            break;
            
        case 'embed':
            updatedBlock.content = form.querySelector('[name="embed-url"]')?.value || '';
            // T√≠pus automatikus detekt√°l√°sa
            updatedBlock.attributes.type = detectEmbedType(updatedBlock.content);
            break;
            
        default:
            try {
                const newContent = form.querySelector('[name="block-content"]')?.value || '';
                updatedBlock.content = newContent;
            } catch (e) {
                console.error('Hiba a blokk friss√≠t√©se sor√°n:', e);
            }
    }
    
    // ID gener√°l√°sa, ha nincs
    if (!updatedBlock.id) {
        updatedBlock.id = `block_${Date.now()}_${index}`;
    }
    
    return updatedBlock;
}



/**
 * Blokk t√∂rl√©se
 */
async function moveBlockUp(index, block) {
    if (index <= 0) {
        showSuccessNotification('Ez a blokk m√°r a legels≈ë helyen van!', 'warning');
        return;
    }
    
    // Csere
    const temp = window.editorBlocks[index];
    window.editorBlocks[index] = window.editorBlocks[index - 1];
    window.editorBlocks[index - 1] = temp;
    
    // Friss√≠tj√ºk a megjelen√≠t√©st
    refreshBlockDisplay();
    
    showSuccessNotification('Blokk feljebb mozgatva!');
}

function refreshBlockDisplay() {
    const container = document.getElementById('block-editor-container');
    const blocks = [...window.editorBlocks];
    
    console.log('Refreshing block display with', blocks.length, 'blocks');

    const scrollPos = container.scrollTop;
    container.innerHTML = '';
    
    const config = getBlockConfig();
    blocks.forEach((block, index) => {
        const blockDiv = createBlockElement(block, index, config);
        container.appendChild(blockDiv);
    });
    
    // Drag & drop √∫jrainicializ√°l√°sa
    setupDragAndDrop();
    
    // Textarea friss√≠t√©se
    updateTextareaFromBlocks();

    container.scrollTop = scrollPos;
    
    // K√©pek preloadol√°sa - √öJ
    preloadAllImages();
    
    console.log('Block display refreshed with', blocks.length, 'blocks');
}

function preloadAllImages() {
    const imageBlocks = window.editorBlocks.filter(block => block.type === 'image' && block.content);
    
    imageBlocks.forEach((block, index) => {
        if (block.content && (block.content.startsWith('http') || block.content.startsWith('data:'))) {
            // Preload a h√°tt√©rben
            const img = new Image();
            img.src = block.content;
            img.onload = function() {
                // K√©p bet√∂lt≈ëd√∂tt, friss√≠ts√ºk az el≈ën√©zetet
                updateImagePreviewInBlock(index, block.content);
            };
        }
    });
}

// 4. K√©p el≈ën√©zet friss√≠t√©se blokkban - √öJ f√ºggv√©ny
function updateImagePreviewInBlock(blockIndex, imageUrl) {
    const block = document.querySelector(`.draggable-block[data-block-index="${blockIndex}"]`);
    if (!block) return;
    
    const previewDiv = block.querySelector('.image-preview');
    if (previewDiv) {
        const img = previewDiv.querySelector('img');
        if (img && img.src !== imageUrl) {
            img.src = imageUrl;
        }
    }
}


function updateTextareaFromBlocks() {
    const textarea = document.getElementById('edit-content');
    if (!textarea || !window.editorBlocks) return;
    
    let htmlContent = '';
    window.editorBlocks.forEach((block, index) => {
        const blockHtml = generateHTMLFromBlock(block);
        if (blockHtml) {
            htmlContent += blockHtml + '\n\n';
        }
    });
    
    textarea.value = htmlContent.trim();
    console.log('Textarea updated from blocks');
}
/**
 * Blokk lejjebb mozgat√°sa
 */
async function moveBlockDown(index, block) {
    if (index >= window.editorBlocks.length - 1) {
        showSuccessNotification('Ez a blokk m√°r a legutols√≥ helyen van!', 'warning');
        return;
    }
    
    // Csere
    const temp = window.editorBlocks[index];
    window.editorBlocks[index] = window.editorBlocks[index + 1];
    window.editorBlocks[index + 1] = temp;
    
    // Friss√≠tj√ºk a megjelen√≠t√©st
    refreshBlockDisplay();
    
    showSuccessNotification('Blokk lejjebb mozgatva!');
}

/**
 * Blokk t√∂rl√©se
 */
async function deleteBlock(index, block) {
    const result = await showConfirmModal({
        title: 'Blokk t√∂rl√©se',
        message: `Biztosan t√∂r√∂lni szeretn√©d ezt a blokkot?`,
        subMessage: `Ez a m≈±velet nem visszavonhat√≥!`,
        icon: 'trash-outline',
        confirmText: 'Igen, t√∂rl√∂m',
        cancelText: 'M√©gse',
        details: [
            { label: 'Poz√≠ci√≥', value: index + 1 },
            { label: 'T√≠pus', value: getBlockTypeName(block.type) },
            { label: 'Tartalom', value: block.content ? block.content.substring(0, 50) + (block.content.length > 50 ? '...' : '') : '√úres' }
        ]
    });
    
    if (result) {
        // Blokk elt√°vol√≠t√°sa a t√∂mbb≈ël
        window.editorBlocks.splice(index, 1);
        
        // Friss√≠tj√ºk a megjelen√≠t√©st
        refreshBlockDisplay();
        
        showSuccessNotification('Blokk sikeresen t√∂r√∂lve!');
    }
}


/**
 * Blokk elem l√©trehoz√°sa - √öJ
 */
/**
 * Blokk elem l√©trehoz√°sa - TELJESEN JAV√çTVA
 */
function createBlockElement(block, index, config) {
    const blockDiv = document.createElement('div');
    blockDiv.className = 'review-block draggable-block';
    blockDiv.draggable = true;
    blockDiv.dataset.blockIndex = index;
    blockDiv.dataset.blockType = block.type;
    
    const blockColors = config.colors || {
        'heading': '#1891d1',
        'paragraph': '#4a6cf7',
        'image': '#20c997',
        'quote': '#6f42c1',
        'list': '#fd7e14',
        'code': '#343a40',
        'divider': '#6c757d',
        'embed': '#17a2b8'
    };
    
    blockDiv.style.cssText = `
        margin-bottom: 15px;
        padding: 15px;
        border: 2px solid ${blockColors[block.type] || '#e2e8f0'};
        border-radius: 8px;
        background: white;
        position: relative;
        transition: all 0.3s ease;
        cursor: move;
    `;
    
    // Fejl√©c
    const headerDiv = document.createElement('div');
    headerDiv.style.cssText = `
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 10px;
        border-bottom: 1px solid #f1f1f1;
    `;
    
    // Bal oldal: poz√≠ci√≥ √©s t√≠pus
    const leftInfo = document.createElement('div');
    leftInfo.style.cssText = `
        display: flex;
        align-items: center;
        gap: 10px;
    `;
    
    // Poz√≠ci√≥ badge
    const posBadge = document.createElement('div');
    posBadge.style.cssText = `
        background: #6c757d;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    `;
    posBadge.textContent = `#${index + 1}`;
    
    // T√≠pus badge
    const typeBadge = document.createElement('div');
    typeBadge.style.cssText = `
        background: ${blockColors[block.type] || '#4a6cf7'};
        color: white;
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
    `;
    typeBadge.innerHTML = `
        <ion-icon name="${config.icons[block.type] || 'cube-outline'}" style="font-size: 14px;"></ion-icon>
        ${getBlockTypeName(block.type)}
    `;
    
    // Jobb oldal: m≈±veletek
    const rightActions = document.createElement('div');
    rightActions.style.cssText = `
        display: flex;
        gap: 5px;
    `;
    
    // M≈±velet gombok
    const actionButtons = [
        { icon: 'create-outline', title: 'Szerkeszt√©s', action: 'edit' },
        { icon: 'copy-outline', title: 'Duplik√°l√°s', action: 'duplicate' },
        { icon: 'trash-outline', title: 'T√∂rl√©s', action: 'delete', color: '#e74c3c' }
    ];
    
    actionButtons.forEach(btn => {
        const btnEl = document.createElement('button');
        btnEl.type = 'button';
        btnEl.title = btn.title;
        btnEl.style.cssText = `
            background: ${btn.color || '#f8f9fa'};
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            color: ${btn.color ? 'white' : '#495057'};
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            transition: all 0.2s;
        `;
        btnEl.innerHTML = `<ion-icon name="${btn.icon}" style="font-size: 14px;"></ion-icon>`;
        
        btnEl.onmouseenter = () => {
            btnEl.style.background = btn.color || '#e9ecef';
        };
        btnEl.onmouseleave = () => {
            btnEl.style.background = btn.color || '#f8f9fa';
        };
        
        btnEl.onclick = () => handleBlockAction(btn.action, index, block);
        rightActions.appendChild(btnEl);
    });
    
    leftInfo.appendChild(posBadge);
    leftInfo.appendChild(typeBadge);
    headerDiv.appendChild(leftInfo);
    headerDiv.appendChild(rightActions);
    
    // Blokk tartalom
    const contentDiv = document.createElement('div');
    contentDiv.style.cssText = `
        margin-top: 10px;
        padding: 12px;
        background: #f8fafc;
        border-radius: 6px;
        font-size: 14px;
        line-height: 1.5;
        white-space: pre-wrap;
        word-wrap: break-word;
        min-height: 50px;
        border-left: 3px solid ${blockColors[block.type] || '#4a6cf7'};
    `;
    
    let contentText = '';
    
    switch(block.type) {
        case 'heading':
            const level = block.attributes?.level || 'h2';
            contentText = `üìù ${level.toUpperCase()}: ${block.content || ''}`;
            break;
            
        case 'paragraph':
            contentText = `üìÑ ${block.content || ''}`;
            break;
            
        // 1. El≈ësz√∂r m√≥dos√≠tsuk a k√©pblokk gener√°l√°s√°t (createBlockElement f√ºggv√©nyben)
// A createBlockElement f√ºggv√©nyben a k√©pblokk r√©sz√©t m√≥dos√≠tjuk:
case 'image':
    // NE JELEN√çTSD MEG A LINKET A TARTALOM SZ√ñV√âGBEN!
    // contentText = `üñºÔ∏è K√©p: ${block.content || ''}\n`; // EZT T√ÅVOL√çTSD EL!
    
    // Ink√°bb csak a meta inform√°ci√≥kat jelen√≠tsd meg
    contentText = `üñºÔ∏è K√©p\n`;
    if (block.attributes?.alt) {
        contentText += `Alt: ${block.attributes.alt}\n`;
    }
    if (block.attributes?.caption) {
        contentText += `Al√°√≠r√°s: ${block.attributes.caption}`;
    }
    
    // K√©p el≈ën√©zet hozz√°ad√°sa - JAV√çTOTT VERZI√ì
    const previewContainer = document.createElement('div');
    previewContainer.className = 'image-preview-container';
    previewContainer.style.cssText = `
        margin-top: 10px;
        max-width: 100%;
        max-height: 200px;
        overflow: hidden;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        position: relative;
        min-height: 120px;
        cursor: pointer;
        transition: all 0.3s ease;
    `;
    
    // K√©p bet√∂lt√©si √°llapot
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'image-loading';
    loadingDiv.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        font-size: 12px;
        background: rgba(255,255,255,0.9);
        z-index: 1;
    `;
    loadingDiv.innerHTML = `
        <ion-icon name="image-outline" style="font-size: 32px; margin-bottom: 8px; opacity: 0.5;"></ion-icon>
        <div>K√©p bet√∂lt√©se...</div>
    `;
    
    // K√©p elem - CSAK HA VAN VAL√ìDI K√âP
    if (block.content && (block.content.startsWith('http') || block.content.startsWith('data:'))) {
        const img = document.createElement('img');
        img.className = 'image-preview';
        img.style.cssText = `
            width: 100%;
            height: auto;
            max-height: 180px;
            object-fit: contain;
            display: block;
            opacity: 0;
            transition: opacity 0.3s ease;
        `;
        img.src = block.content;
        img.alt = block.attributes?.alt || 'K√©p el≈ën√©zet';
        img.title = 'Kattints a nagy√≠t√°shoz';
        
        // K√©p bet√∂lt√©si esem√©nyek
        img.onload = function() {
            this.style.opacity = '1';
            loadingDiv.style.display = 'none';
            
            // Automatikus nagy√≠t√°s, ha a k√©p magas
            if (this.naturalWidth > 0) {
                const aspectRatio = this.naturalHeight / this.naturalWidth;
                if (aspectRatio > 1.5) {
                    this.style.objectFit = 'cover';
                }
            }
        };
        
        img.onerror = function() {
            // Ha nem t√∂lt≈ëdik be a k√©p, mutassunk hiba√ºzenetet
            loadingDiv.innerHTML = `
                <ion-icon name="warning-outline" style="font-size: 32px; margin-bottom: 8px; color: #e74c3c;"></ion-icon>
                <div style="color: #e74c3c;">K√©p nem bet√∂lthet≈ë</div>
                <div style="font-size: 10px; margin-top: 5px; max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                    ${block.content.substring(0, 40)}${block.content.length > 40 ? '...' : ''}
                </div>
            `;
        };
        
        // Kattint√°s esem√©ny a k√©p nagy√≠t√°s√°hoz
        img.onclick = function(e) {
            e.stopPropagation();
            showImageLightbox(block.content, block.attributes?.alt || 'K√©p el≈ën√©zet');
        };
        
        previewContainer.appendChild(loadingDiv);
        previewContainer.appendChild(img);
        
        // Kont√©ner kattint√°s esem√©ny
        previewContainer.onclick = function(e) {
            if (e.target === previewContainer) {
                showImageLightbox(block.content, block.attributes?.alt || 'K√©p el≈ën√©zet');
            }
        };
        
        // Hover effekt
        previewContainer.onmouseenter = function() {
            this.style.borderColor = '#1891d1';
            this.style.boxShadow = '0 4px 12px rgba(24, 145, 209, 0.1)';
        };
        
        previewContainer.onmouseleave = function() {
            this.style.borderColor = '#e2e8f0';
            this.style.boxShadow = 'none';
        };
        
        // Automatikus bet√∂lt√©s ind√≠t√°sa
        setTimeout(() => {
            if (!img.complete) {
                img.src = img.src; // √öjrat√∂lt√©s trigger
            }
        }, 100);
        
    } else {
        // Ha nincs k√©p URL, mutassunk helyettes√≠t≈ët
        previewContainer.innerHTML = `
            <div style="
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 120px;
                color: #718096;
            ">
                <ion-icon name="image-outline" style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;"></ion-icon>
                <div>Nincs k√©p hozz√°adva</div>
            </div>
        `;
        previewContainer.style.cursor = 'default';
    }
    
    // Adjuk hozz√° a tartalom div-hez
    contentDiv.appendChild(previewContainer);
    break;
            
        case 'quote':
            contentText = `üí¨ Id√©zet: ${block.content || ''}\n`;
            if (block.attributes?.author) {
                contentText += `‚Äî ${block.attributes.author}`;
            }
            break;
            
        case 'list':
            contentText = `üìã Lista (${block.attributes?.type || 'ul'}):\n`;
            const items = Array.isArray(block.content) ? block.content : [block.content];
            items.forEach((item, i) => {
                contentText += `  ${i + 1}. ${item || ''}\n`;
            });
            break;
            
        case 'code':
            const lang = block.attributes?.language || 'nincs megadva';
            contentText = `üíª K√≥d (${lang}):\n${block.content || ''}`;
            break;
            
        case 'divider':
            contentText = `‚ûñ Elv√°laszt√≥ sor`;
            break;
            
        case 'embed':
            contentText = `üîó Be√°gyaz√°s: ${block.content || ''}`;
            if (block.attributes?.type) {
                contentText += `\nT√≠pus: ${block.attributes.type}`;
            }
            break;
            
        default:
            contentText = `‚ùì Ismeretlen blokk: ${JSON.stringify(block, null, 2)}`;
    }
    
    contentDiv.textContent = contentText;
    
    // Attrib√∫tumok megjelen√≠t√©se (ha vannak)
    if (block.attributes && Object.keys(block.attributes).length > 0) {
        const attrsDiv = document.createElement('div');
        attrsDiv.style.cssText = `
            margin-top: 10px;
            padding: 8px;
            background: #e8f4fd;
            border-radius: 4px;
            font-size: 12px;
            color: #1891d1;
        `;
        
        let attrsText = '‚öôÔ∏è Attrib√∫tumok: ';
        Object.entries(block.attributes).forEach(([key, value]) => {
            if (value && value !== '') {
                attrsText += `${key}: ${value}; `;
            }
        });
        
        attrsDiv.textContent = attrsText.trim();
        contentDiv.appendChild(attrsDiv);
    }
    
    blockDiv.appendChild(headerDiv);
    blockDiv.appendChild(contentDiv);
    
    return blockDiv;
}
/**
 * Blokk konfigur√°ci√≥ lek√©rdez√©se - √öJ
 */
function getBlockConfig() {
    return {
        icons: {
            'paragraph': 'document-text-outline',
            'heading': 'text-outline',
            'image': 'image-outline',
            'quote': 'quote-outline',
            'list': 'list-outline',
            'code': 'code-slash-outline',
            'divider': 'remove-outline',
            'embed': 'link-outline'
        },
        colors: {
            'heading': '#1891d1',
            'paragraph': '#4a6cf7',
            'image': '#20c997',
            'quote': '#6f42c1',
            'list': '#fd7e14',
            'code': '#343a40',
            'divider': '#6c757d',
            'embed': '#17a2b8'
        }
    };
}
/**
function addSaveBlocksButton() {
    const container = document.getElementById('block-editor-container');
    if (!container) return;
    
    // Ellen≈ërizz√ºk, hogy m√°r van-e ment√©s gomb
    if (container.querySelector('.save-blocks-btn')) return;
    
    const saveButton = document.createElement('button');
    saveButton.className = 'save-blocks-btn btn-success';
    saveButton.innerHTML = `
        <ion-icon name="save-outline"></ion-icon>
        <span style="font-family: 'Abril Fatface'; font-size: 16px">Blokkok ment√©se</span>
    `;
    
    saveButton.style.cssText = `
        margin-top: 20px;
        padding: 12px 24px;
        background: #20c997;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        transition: all 0.3s;
    `;
    
    saveButton.onmouseenter = () => {
        saveButton.style.background = '#1aa179';
        saveButton.style.transform = 'translateY(-2px)';
    };
    
    saveButton.onmouseleave = () => {
        saveButton.style.background = '#20c997';
        saveButton.style.transform = 'translateY(0)';
    };
    
    saveButton.onclick = async () => {
        await saveBlocksToServer();
    };
    
    container.appendChild(saveButton);
}
 */
/**
 * Blokkok ment√©se a szerverre
 */
async function saveBlocksToServer() {
    try {
        const token = getAuthToken();
        if (!token) {
            alert('Nincs bejelentkezve!');
            return;
        }
        
        if (!window.editorBlocks || window.editorBlocks.length === 0) {
            alert('Nincsenek blokkok a ment√©shez!');
            return;
        }
        
        // Blokkok valid√°l√°sa
        const hasInvalidBlocks = window.editorBlocks.some(block => !block.type);
        if (hasInvalidBlocks) {
            alert('Hib√°s blokk(ok) tal√°lhat√≥(k)! K√©rlek ellen≈ërizd a blokkokat.');
            return;
        }
        
        // Meger≈ës√≠t√©s
        const result = await showConfirmModal({
            title: 'Blokkok ment√©se',
            message: 'Biztosan menteni szeretn√©d a blokk m√≥dos√≠t√°sokat?',
            subMessage: 'Ez fel√ºl√≠rja a jelenlegi blokk strukt√∫r√°t.',
            icon: 'save-outline',
            confirmText: 'Igen, mentem',
            cancelText: 'M√©gse',
            details: [
                { label: 'Blokkok sz√°ma', value: window.editorBlocks.length },
                { label: 'M√≥dos√≠t√°sok', value: 'A teljes blokk strukt√∫ra friss√ºl' }
            ]
        });
        
        if (!result) return;
        
        // HTML gener√°l√°sa blokkokb√≥l
        let htmlContent = '';
        window.editorBlocks.forEach((block, index) => {
            const blockHtml = generateHTMLFromBlock(block);
            if (blockHtml) {
                htmlContent += blockHtml + '\n\n';
            }
        });
        
        // API h√≠v√°s
        const response = await fetch('/api/post/edit', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                post: parseInt(postId),
                desc: htmlContent.trim(),
                blocks_json: JSON.stringify(window.editorBlocks),
                content_type: 'blocks'
            })
        });
        
        if (response.ok) {
            const result = await response.json();
            showSuccessNotification('Blokkok sikeresen mentve!', 'success');
            
            // Friss√≠tj√ºk az eredeti adatokat
            if (originalPost) {
                originalPost.desc = htmlContent.trim();
                originalPost.blocks_json = JSON.stringify(window.editorBlocks);
            }
            
            // Textarea friss√≠t√©se
            const textarea = document.getElementById('edit-content');
            if (textarea) {
                textarea.value = htmlContent.trim();
            }
            
            console.log('Blocks saved successfully');
            
        } else {
            const error = await response.text();
            showSuccessNotification(`Hiba: ${error}`, 'error');
        }
        
    } catch (error) {
        console.error('Hiba a blokkok ment√©se sor√°n:', error);
        showSuccessNotification('Hiba t√∂rt√©nt a ment√©s sor√°n!', 'error');
    }
}

/**
 * Embed t√≠pus detekt√°l√°sa
 */
function detectEmbedType(url) {
    if (!url) return 'unknown';
    
    if (url.includes('youtube.com') || url.includes('youtu.be')) {
        return 'youtube';
    } else if (url.includes('vimeo.com')) {
        return 'vimeo';
    } else if (url.includes('twitter.com') || url.includes('x.com')) {
        return 'twitter';
    } else if (url.includes('instagram.com')) {
        return 'instagram';
    } else if (url.includes('spotify.com')) {
        return 'spotify';
    } else {
        return 'generic';
    }
}

/**
 * Sikeres/hiba √ºzenet megjelen√≠t√©se
 */
function showSuccessNotification(message, type = 'success') {
    // Egyszer≈± alert most, k√©s≈ëbb lehet modal
    if (type === 'success') {
        alert(`‚úÖ ${message}`);
    } else if (type === 'warning') {
        alert(`‚ö†Ô∏è ${message}`);
    } else {
        alert(`‚ùå ${message}`);
    }
}
/**
 * Meger≈ës√≠t≈ë modal megjelen√≠t√©se
 */
async function showConfirmModal(options = {}) {
    return new Promise((resolve) => {
        const modalId = 'confirm-modal-' + Date.now();
        const config = {
            title: 'Meger≈ës√≠t√©s sz√ºks√©ges',
            message: 'Biztosan szeretn√©d v√©grehajtani ezt a m≈±veletet?',
            subMessage: '',
            confirmText: 'Igen',
            cancelText: 'M√©gse',
            icon: 'alert-circle-outline',
            ...options
        };
        
        const modalHTML = `
            <div class="confirm-modal" id="${modalId}">
                <div class="confirm-modal-content">
                    <div class="confirm-modal-header">
                        <ion-icon name="${config.icon}"></ion-icon>
                        <h3>${config.title}</h3>
                        <button class="close-modal-btn">√ó</button>
                    </div>
                    
                    <div class="confirm-modal-body">
                        <p>${config.message}</p>
                        ${config.subMessage ? `<p class="sub-message">${config.subMessage}</p>` : ''}
                        
                        ${config.details && config.details.length > 0 ? `
                        <div class="details-list">
                            ${config.details.map(item => `
                                <div class="detail-item">
                                    <span class="label">${item.label}:</span>
                                    <span class="value">${item.value}</span>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="confirm-modal-footer">
                        <button type="button" class="btn-secondary" id="${modalId}-cancel">
                            ${config.cancelText}
                        </button>
                        <button type="button" class="btn-danger" id="${modalId}-confirm">
                            ${config.confirmText}
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        const modalContainer = document.createElement('div');
        modalContainer.innerHTML = modalHTML;
        document.body.appendChild(modalContainer);
        
        const modal = document.getElementById(modalId);
        const confirmBtn = document.getElementById(`${modalId}-confirm`);
        const cancelBtn = document.getElementById(`${modalId}-cancel`);
        const closeBtn = modal.querySelector('.close-modal-btn');
        
        const handleConfirm = () => {
            modal.remove();
            resolve(true);
        };
        
        const handleCancel = () => {
            modal.remove();
            resolve(false);
        };
        
        confirmBtn.addEventListener('click', handleConfirm);
        cancelBtn.addEventListener('click', handleCancel);
        closeBtn.addEventListener('click', handleCancel);
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) handleCancel();
        });
        
        // ESC billenty≈±
        const handleEsc = (e) => {
            if (e.key === 'Escape') handleCancel();
        };
        document.addEventListener('keydown', handleEsc);
        
        setTimeout(() => {
            modal.classList.add('active');
            confirmBtn.focus();
        }, 10);
        
        // Cleanup
        modal.addEventListener('transitionend', () => {
            if (!modal.classList.contains('active')) {
                modal.remove();
                document.removeEventListener('keydown', handleEsc);
            }
        });
    });
}
    </script>


<script>
    /**
     * √öj blokk hozz√°ad√°sa a szerkeszt≈ë eszk√∂zt√°r√°hoz
     */
    function initializeNewBlockButtons() {
        const toolbar = document.querySelector('.editor-toolbar');
        if (!toolbar) return;

        // K√©t gomb kont√©ner l√©trehoz√°sa bal oldalra
        const leftButtonsContainer = document.createElement('div');
        leftButtonsContainer.style.cssText = `
            display: flex;
            gap: 10px;
            margin-right: auto;
            align-items: center;
        `;

        // 1. M√≥dos√≠t√°sok ment√©se gomb
        const saveChangesBtn = document.createElement('button');
        saveChangesBtn.type = 'button';
        saveChangesBtn.className = 'toolbar-btn';
        saveChangesBtn.innerHTML = '<ion-icon name="save-outline"></ion-icon> M√≥dos√≠t√°sok ment√©se';
        saveChangesBtn.style.cssText = `
            background: #20c997 !important;
            color: white !important;
            border-color: #20c997 !important;
            font-weight: 500;
        `;
        saveChangesBtn.onclick = async function() {
            await saveBlocksToServer();
        };

        // 2. √öj blokk hozz√°ad√°sa gomb
        const addBlockBtn = document.createElement('button');
        addBlockBtn.type = 'button';
        addBlockBtn.className = 'toolbar-btn';
        addBlockBtn.innerHTML = '<ion-icon name="add-outline"></ion-icon> √öj blokk hozz√°ad√°sa';
        addBlockBtn.onclick = function() {
            openBlockSelector();
        };

        // Gombok hozz√°ad√°sa a kont√©nerhez
        leftButtonsContainer.appendChild(saveChangesBtn);
        leftButtonsContainer.appendChild(addBlockBtn);

        // Keresd meg a blokkos n√©zet gombot
        const blockViewBtn = document.getElementById('block-view-toggle');
        if (blockViewBtn) {
            // Besz√∫r√°s a blokkos n√©zet gomb el√©
            toolbar.insertBefore(leftButtonsContainer, blockViewBtn);
        } else {
            // Ha nincs blokkos n√©zet gomb, adjuk hozz√° az elej√©re
            toolbar.insertBefore(leftButtonsContainer, toolbar.firstChild);
        }

        // St√≠lusok hozz√°ad√°sa a hover √°llapothoz
        const style = document.createElement('style');
        style.textContent = `
            /* Ment√©s gomb hover √°llapot */
            .toolbar-btn[onclick*="saveBlocksToServer"]:hover {
                background: #1aa179 !important;
                border-color: #1aa179 !important;
                transform: translateY(-1px);
            }
            
            /* √öj blokk gomb hover √°llapot */
            .toolbar-btn[onclick*="openBlockSelector"]:hover {
                background: #1891d1 !important;
                border-color: #1891d1 !important;
                transform: translateY(-1px);
            }
            
            /* Toolbar gombok alap st√≠lus */
            .toolbar-btn {
                transition: all 0.2s ease !important;
                display: flex !important;
                align-items: center !important;
                gap: 5px !important;
                font-family: 'Abril Fatface', cursive !important;
            }
            
            /* Bal oldali gombok kont√©ner anim√°ci√≥ */
            #left-toolbar-buttons {
                animation: fadeInLeft 0.5s ease-out;
            }
            
            @keyframes fadeInLeft {
                from {
                    opacity: 0;
                    transform: translateX(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
        `;
        document.head.appendChild(style);

        // Adjunk ID-t a kont√©nernek anim√°ci√≥hoz
        leftButtonsContainer.id = 'left-toolbar-buttons';
    }

    /**
     * Blokk kiv√°laszt√≥ modal megnyit√°sa
     */
    function openBlockSelector() {
        const modalHTML = `
            <div class="block-selector-modal active" id="block-selector-modal">
                <div class="block-selector-content">
                    <div class="block-selector-header">
                        <h3>Blokk t√≠pus kiv√°laszt√°sa</h3>
                        <button class="close-block-selector">
                            <ion-icon name="close-outline"></ion-icon>
                        </button>
                    </div>
                    
                    <div class="block-selector-grid">
                        <div class="block-type-card" data-type="heading" onclick="addNewBlock('heading')">
                            <div class="block-type-icon">
                                <ion-icon name="text-outline"></ion-icon>
                            </div>
                            <div class="block-type-info">
                                <h4>C√≠msor</h4>
                                <p>F≈ëc√≠m vagy alc√≠m hozz√°ad√°sa</p>
                            </div>
                        </div>
                        
                        <div class="block-type-card" data-type="paragraph" onclick="addNewBlock('paragraph')">
                            <div class="block-type-icon">
                                <ion-icon name="text-outline"></ion-icon>
                            </div>
                            <div class="block-type-info">
                                <h4>Bekezd√©s</h4>
                                <p>Sz√∂veges tartalom hozz√°ad√°sa</p>
                            </div>
                        </div>
                        
                        <div class="block-type-card" data-type="image" onclick="addNewBlock('image')">
                            <div class="block-type-icon">
                                <ion-icon name="image-outline"></ion-icon>
                            </div>
                            <div class="block-type-info">
                                <h4>K√©p</h4>
                                <p>K√©p beilleszt√©se URL vagy felt√∂lt√©s √∫tj√°n</p>
                            </div>
                        </div>
                        
                        <div class="block-type-card" data-type="quote" onclick="addNewBlock('quote')">
                            <div class="block-type-icon">
                                <ion-icon name="quote-outline"></ion-icon>
                            </div>
                            <div class="block-type-info">
                                <h4>Id√©zet</h4>
                                <p>Id√©zet hozz√°ad√°sa szerz≈ëvel</p>
                            </div>
                        </div>
                        
                        <div class="block-type-card" data-type="list" onclick="addNewBlock('list')">
                            <div class="block-type-icon">
                                <ion-icon name="list-outline"></ion-icon>
                            </div>
                            <div class="block-type-info">
                                <h4>Lista</h4>
                                <p>Pontozott vagy sz√°mozott lista</p>
                            </div>
                        </div>
                        
                        <div class="block-type-card" data-type="code" onclick="addNewBlock('code')">
                            <div class="block-type-icon">
                                <ion-icon name="code-slash-outline"></ion-icon>
                            </div>
                            <div class="block-type-info">
                                <h4>K√≥d</h4>
                                <p>K√≥dr√©szlet programoz√°si nyelvvel</p>
                            </div>
                        </div>
                        
                        <div class="block-type-card" data-type="divider" onclick="addNewBlock('divider')">
                            <div class="block-type-icon">
                                <ion-icon name="remove-outline"></ion-icon>
                            </div>
                            <div class="block-type-info">
                                <h4>Elv√°laszt√≥</h4>
                                <p>V√≠zszintes elv√°laszt√≥ sor</p>
                            </div>
                        </div>
                        
                        <div class="block-type-card" data-type="embed" onclick="addNewBlock('embed')">
                            <div class="block-type-icon">
                                <ion-icon name="link-outline"></ion-icon>
                            </div>
                            <div class="block-type-info">
                                <h4>Be√°gyaz√°s</h4>
                                <p>YouTube, Twitter, stb. tartalom</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="block-selector-footer">
                        <button type="button" class="btn-secondary close-block-selector-btn">
                            <span style="font-family: 'Abril Fatface'; font-size: 16px">M√©gse
                        </button>
                    </div>
                </div>
            </div>
            
            <style>
                .block-selector-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    opacity: 0;
                    visibility: hidden;
                    transition: all 0.3s;
                }
                
                .block-selector-modal.active {
                    opacity: 1;
                    visibility: visible;
                }
                
                .block-selector-content {
                    background: white;
                    border-radius: 12px;
                    width: 90%;
                    max-width: 800px;
                    max-height: 80vh;
                    overflow-y: auto;
                    transform: translateY(-20px);
                    transition: transform 0.3s;
                }
                
                .block-selector-modal.active .block-selector-content {
                    transform: translateY(0);
                }
                
                .block-selector-header {
                    padding: 20px;
                    border-bottom: 1px solid #e2e8f0;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .block-selector-header h3 {
                    margin: 0;
                    color: #2d3748;
                }
                
                .block-selector-header .close-block-selector {
                    background: none;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #718096;
                }
                
                .block-selector-grid {
                    padding: 20px;
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                    gap: 15px;
                }
                
                .block-type-card {
                    border: 2px solid #e2e8f0;
                    border-radius: 8px;
                    padding: 15px;
                    cursor: pointer;
                    transition: all 0.3s;
                    display: flex;
                    align-items: flex-start;
                    gap: 12px;
                }
                
                .block-type-card:hover {
                    border-color: #1891d1;
                    background: #f0f9ff;
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(24, 145, 209, 0.1);
                }
                
                .block-type-icon {
                    background: #1891d1;
                    color: white;
                    width: 40px;
                    height: 40px;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    flex-shrink: 0;
                }
                
                .block-type-icon ion-icon {
                    font-size: 20px;
                }
                
                .block-type-info h4 {
                    margin: 0 0 5px 0;
                    color: #2d3748;
                    font-size: 15px;
                }
                
                .block-type-info p {
                    margin: 0;
                    color: #718096;
                    font-size: 13px;
                    line-height: 1.4;
                }
                
                .block-selector-footer {
                    padding: 20px;
                    border-top: 1px solid #e2e8f0;
                    text-align: right;
                }
                
                @media (max-width: 768px) {
                    .block-selector-grid {
                        grid-template-columns: 1fr;
                    }
                }
            </style>
        `;

        const modalContainer = document.createElement('div');
        modalContainer.innerHTML = modalHTML;
        document.body.appendChild(modalContainer);

        const modal = document.getElementById('block-selector-modal');
        const closeButtons = modalContainer.querySelectorAll('.close-block-selector, .close-block-selector-btn');

        closeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                closeBlockSelector();
            });
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeBlockSelector();
            }
        });

        document.addEventListener('keydown', function onEsc(e) {
            if (e.key === 'Escape') {
                closeBlockSelector();
                document.removeEventListener('keydown', onEsc);
            }
        });

        function closeBlockSelector() {
            modal.classList.remove('active');
            setTimeout(() => {
                modalContainer.remove();
            }, 300);
        }

        setTimeout(() => {
            modal.classList.add('active');
        }, 10);
    }

    /**
     * √öj blokk hozz√°ad√°sa a szerkeszt≈ëh√∂z
     */
    function addNewBlock(blockType) {
        // Ellen≈ërizz√ºk, hogy a blokk szerkeszt≈ë l√°that√≥-e
        const blockEditor = document.getElementById('block-editor-container');
        const isBlockView = blockEditor.style.display !== 'none';

        // Ha nem a blokk n√©zetben vagyunk, v√°ltunk r√°
        if (!isBlockView) {
            toggleBlockView();
        }

        // √öj blokk l√©trehoz√°sa
        const newBlock = createNewBlock(blockType);
        
        // Hozz√°ad√°s a blokk list√°hoz
        if (window.editorBlocks) {
            window.editorBlocks.push(newBlock);
        } else {
            window.editorBlocks = [newBlock];
        }

        // Friss√≠tj√ºk a megjelen√≠t√©st
        refreshBlockDisplay();

        // Modal bez√°r√°sa
        const modal = document.getElementById('block-selector-modal');
        if (modal) {
            modal.querySelector('.close-block-selector').click();
        }

        // Sikeres √ºzenet
        showSuccessNotification(`√öj ${getBlockTypeName(blockType)} blokk hozz√°adva!`, 'success');
        
        // G√∂rget√©s az √∫j blokkhoz
        setTimeout(() => {
            const blocks = document.querySelectorAll('.review-block');
            if (blocks.length > 0) {
                blocks[blocks.length - 1].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }, 100);
    }

    /**
     * √öj blokk objektum l√©trehoz√°sa
     */
    function createNewBlock(blockType) {
        const blockId = `block_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        
        const baseBlock = {
            id: blockId,
            type: blockType,
            content: '',
            attributes: {},
            styles: {},
            position: window.editorBlocks ? window.editorBlocks.length : 0
        };

        switch(blockType) {
            case 'heading':
                baseBlock.content = '√öj c√≠msor';
                baseBlock.attributes.level = 'h2';
                break;
                
            case 'paragraph':
                baseBlock.content = '√öj bekezd√©s sz√∂vege...';
                break;
                
            case 'image':
                baseBlock.content = '';
                baseBlock.attributes.alt = '';
                baseBlock.attributes.caption = '';
                break;
                
            case 'quote':
                baseBlock.content = '√öj id√©zet sz√∂vege...';
                baseBlock.attributes.author = '';
                break;
                
            case 'list':
                baseBlock.content = ['Els≈ë elem', 'M√°sodik elem', 'Harmadik elem'];
                baseBlock.attributes.type = 'ul';
                break;
                
            case 'code':
                baseBlock.content = 'console.log("Hello World!");';
                baseBlock.attributes.language = 'javascript';
                break;
                
            case 'divider':
                baseBlock.content = 'divider';
                break;
                
            case 'embed':
                baseBlock.content = '';
                baseBlock.attributes.type = '';
                break;
        }

        return baseBlock;
    }

    /**
     * Inicializ√°ljuk a gombot, amikor az oldal bet√∂lt≈ëdik
     */
    document.addEventListener('DOMContentLoaded', function() {
        // V√°runk egy kicsit, hogy minden bet√∂lt≈ëdj√∂n
        setTimeout(() => {
            initializeNewBlockButtons();
        }, 1000);
    });

    // CSS st√≠lusok hozz√°ad√°sa a megl√©v≈ë st√≠lusokhoz
    const style = document.createElement('style');
    style.textContent = `
        /* √öj blokk gomb st√≠lusai */
        .toolbar-btn[onclick*="openBlockSelector"] {
            background: #20c997 !important;
            color: white !important;
            border-color: #20c997 !important;
        }
        
        .toolbar-btn[onclick*="openBlockSelector"]:hover {
            background: #1aa179 !important;
            border-color: #1aa179 !important;
        }
        
        /* Succes notification animation */
        @keyframes slideInUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10001;
            animation: slideInUp 0.3s ease-out;
            border-left: 4px solid #20c997;
        }
        
        .notification.success {
            border-left-color: #20c997;
        }
        
        .notification.error {
            border-left-color: #e74c3c;
        }
        
        .notification.warning {
            border-left-color: #f39c12;
        }
        
        .notification.info {
            border-left-color: #3498db;
        }
        
        .notification ion-icon {
            font-size: 20px;
        }
        
        .notification.success ion-icon {
            color: #20c997;
        }
        
        .notification.error ion-icon {
            color: #e74c3c;
        }
        
        .notification.warning ion-icon {
            color: #f39c12;
        }
        
        .notification.info ion-icon {
            color: #3498db;
        }
    `;
    document.head.appendChild(style);

    /**
     * Sikeres √ºzenet megjelen√≠t√©se
     */
    function showSuccessNotification(message, type = 'success') {
        // T√°vol√≠tsuk el a kor√°bbi √©rtes√≠t√©seket
        document.querySelectorAll('.notification').forEach(n => n.remove());

        const iconName = {
            'success': 'checkmark-circle-outline',
            'error': 'alert-circle-outline',
            'warning': 'warning-outline',
            'info': 'information-circle-outline'
        }[type] || 'information-circle-outline';

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <ion-icon name="${iconName}"></ion-icon>
            <span>${message}</span>
        `;

        document.body.appendChild(notification);

        // Automatikus elt√°vol√≠t√°s 3 m√°sodperc ut√°n
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transform = 'translateY(100%)';
            setTimeout(() => {
                notification.remove();
            }, 300);
        }, 3000);
    }


    // 6. K√©p nagy√≠t√≥ lightbox - √öJ f√ºggv√©ny
function showImageLightbox(imageUrl, altText) {
    const lightboxHTML = `
        <div class="image-lightbox active">
            <div class="lightbox-overlay"></div>
            <div class="lightbox-content">
                <div class="lightbox-header">
                    <h4>K√©p el≈ën√©zet</h4>
                    <button class="close-lightbox">
                        <ion-icon name="close-outline"></ion-icon>
                    </button>
                </div>
                <div class="lightbox-image-container">
                    <img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(altText)}" class="lightbox-image">
                </div>
                <div class="lightbox-footer">
                    <div class="image-info">
                        <div class="info-item">
                            <span class="label">URL:</span>
                            <span class="value">${imageUrl.length > 50 ? imageUrl.substring(0, 50) + '...' : imageUrl}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Alt sz√∂veg:</span>
                            <span class="value">${altText || 'Nincs megadva'}</span>
                        </div>
                    </div>
                    <div class="lightbox-actions">
                        <button class="btn-secondary" onclick="copyImageUrl('${escapeHtml(imageUrl)}')">
                            <ion-icon name="copy-outline"></ion-icon>
                            URL m√°sol√°sa
                        </button>
                        <a href="${escapeHtml(imageUrl)}" target="_blank" class="btn-primary">
                            <ion-icon name="open-outline"></ion-icon>
                            Megnyit√°s √∫j lapon
                        </a>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    const lightboxContainer = document.createElement('div');
    lightboxContainer.innerHTML = lightboxHTML;
    document.body.appendChild(lightboxContainer);
    
    const lightbox = lightboxContainer.querySelector('.image-lightbox');
    const closeBtn = lightboxContainer.querySelector('.close-lightbox');
    const overlay = lightboxContainer.querySelector('.lightbox-overlay');
    
    // Bez√°r√°s
    const closeLightbox = () => {
        lightbox.classList.remove('active');
        setTimeout(() => lightboxContainer.remove(), 300);
    };
    
    closeBtn.addEventListener('click', closeLightbox);
    overlay.addEventListener('click', closeLightbox);
    
    // ESC billenty≈±
    const handleEsc = (e) => {
        if (e.key === 'Escape') closeLightbox();
    };
    document.addEventListener('keydown', handleEsc);
    
    // URL m√°sol√°sa
    window.copyImageUrl = function(url) {
        navigator.clipboard.writeText(url).then(() => {
            showSuccessNotification('URL m√°solva a v√°g√≥lapra!', 'success');
        }).catch(() => {
            showSuccessNotification('Nem siker√ºlt m√°solni!', 'error');
        });
    };
    
    // St√≠lusok hozz√°ad√°sa
    const lightboxStyle = document.createElement('style');
    lightboxStyle.textContent = `
        .image-lightbox {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10002;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .image-lightbox.active {
            opacity: 1;
            visibility: visible;
        }
        
        .lightbox-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }
        
        .lightbox-content {
            position: relative;
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .image-lightbox.active .lightbox-content {
            transform: scale(1);
        }
        
        .lightbox-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .lightbox-header h4 {
            margin: 0;
            color: #2d3748;
        }
        
        .close-lightbox {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
            padding: 5px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-lightbox:hover {
            background: #f8f9fa;
            color: #495057;
        }
        
        .lightbox-image-container {
            max-height: 60vh;
            overflow: auto;
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
        }
        
        .lightbox-image {
            max-width: 100%;
            max-height: 55vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .lightbox-footer {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .image-info {
            margin-bottom: 20px;
        }
        
        .info-item {
            display: flex;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .info-item .label {
            font-weight: 500;
            color: #495057;
            min-width: 80px;
        }
        
        .info-item .value {
            color: #6c757d;
            flex: 1;
            word-break: break-all;
        }
        
        .lightbox-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .lightbox-actions .btn-secondary,
        .lightbox-actions .btn-primary {
            padding: 10px 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .lightbox-actions .btn-primary {
            text-decoration: none;
        }
        
        @media (max-width: 768px) {
            .lightbox-actions {
                flex-direction: column;
            }
            
            .lightbox-image-container {
                padding: 10px;
            }
        }
    `;
    document.head.appendChild(lightboxStyle);
}
</script>
</body>
</html>